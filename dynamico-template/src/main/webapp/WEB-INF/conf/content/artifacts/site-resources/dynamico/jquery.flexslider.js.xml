<?xml version="1.0" encoding="UTF-8"?><jquery.flexslider.js xmlns:nt="http://www.jcp.org/jcr/nt/1.0" xmlns:xcmis="http://www.exoplatform.com/jcr/xcmis/1.0" xmlns:tkn="http://www.gatein.org/jcr/token/1.0/" xmlns:webdav="http://www.exoplatform.org/jcr/webdav" xmlns:gtn="http://www.gatein.org/jcr/gatein/1.0/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:plf="http://www.exoplatform.org/jcr/plf/1.0/" xmlns:jcr="http://www.jcp.org/jcr/1.0" xmlns:wsrp="http://www.gatein.org/jcr/wsrp/1.0/" xmlns:sv="http://www.jcp.org/jcr/sv/1.0" xmlns:ntf="http://www.gatein.org/jcr/ntf/1.0/" xmlns:wiki="http://exoplatform.org/wiki/1.0/" xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:jos="http://www.exoplatform.com/jcr-services/organization-service/1.0/" xmlns:metadata="http://www.exoplatform.com/jcr/metadata/1.1/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:app="http://www.gatein.org/jcr/application-registry/1.0/" xmlns:exoide="http://exoplatform.org/ide/1.1.x/" xmlns:stg="http://www.gatein.org/jcr/stg/1.0/" xmlns:acme="http://www.exoplatform.com/plf/acme/4.0/" xmlns:cmis="http://www.exoplatform.com/jcr/cmis/1.0" xmlns:lgn="http://www.gatein.org/jcr/autologin/1.0/" xmlns:mop="http://www.gatein.org/jcr/mop/1.0/" xmlns:fn_old="http://www.w3.org/2004/10/xpath-functions" xmlns:mix="http://www.jcp.org/jcr/mix/1.0" xmlns:publication="http://www.exoplatform.com/jcr/publication/1.1/" xmlns:exo="http://www.exoplatform.com/jcr/exo/1.0" xmlns:pc="http://www.gatein.org/jcr/pc/1.0/" xmlns:wai="http://www.exoplatform.com/ecm/accessibility/1.0" xmlns:soc="http://www.exoplatform.org/jcr/soc/1.0/" xmlns:rep="internal" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:portlet="http://www.gatein.org/jcr/portlet/1.0/" jcr:primaryType="nt:file" jcr:mixinTypes="exo:sortable exo:owneable exo:datetime exo:modify exo:jsFile mix:commentable mix:votable mix:i18n publication:authoring publication:authoringPublication mix:versionable exo:activityInfo" jcr:uuid="56fc33a77f0000010c56b1bf87702023" exo:active="true" exo:activityId="56fc340e7f00000128d84e9028f0a9d6" exo:dateCreated="2015-05-15T16:51:18.440+07:00" exo:dateModified="2015-05-15T16:51:18.523+07:00" exo:index="1000" exo:language="en" exo:lastModifiedDate="2015-05-15T16:51:18.923+07:00" exo:lastModifier="root" exo:name="jquery.flexslider.js" exo:owner="root" exo:presentationType="exo:jsFile" exo:priority="0" exo:sharedJS="true" exo:title="jquery.flexslider.js" exo:voteTotal="0" exo:voteTotalOfLang="0" exo:votingRate="0.0" publication:currentState="draft" publication:history="jquery.flexslider.js;enrolled;root;2015-05-15T16:51:18.521+07:00;Publication.log.description.enrolled jquery.flexslider.js;draft;root;2015-05-15T16:51:18.522+07:00;PublicationService.AuthoringPublicationPlugin.changeState.draft" publication:lastUser="root" publication:lifecycle="lifecycle1" publication:lifecycleName="Authoring_x0020_publication" publication:revisionData="56fc33a77f0000010c56b1bf87702023,draft,root" jcr:baseVersion="56fc33f87f00000155fbb625abd08991" jcr:created="2015-05-15T16:51:18.440+07:00" jcr:isCheckedOut="true" jcr:predecessors="56fc33f87f00000155fbb625abd08991" jcr:versionHistory="56fc33f87f00000158a7658b9b19b639"><jcr:content jcr:primaryType="nt:resource" jcr:mixinTypes="exo:owneable exo:datetime dc:elementSet" jcr:uuid="56fc33d37f0000015a34b5073cfba556" exo:dateCreated="2015-05-15T16:51:18.483+07:00" exo:dateModified="2015-05-15T16:51:18.483+07:00" exo:internalUse="false" exo:owner="root" jcr:data="LyoNCiAqIGpRdWVyeSBGbGV4U2xpZGVyIHYyLjENCiAqIGh0dHA6Ly93d3cud29vdGhlbWVzLmNvbS9mbGV4c2xpZGVyLw0KICoNCiAqIENvcHlyaWdodCAyMDEyIFdvb1RoZW1lcw0KICogRnJlZSB0byB1c2UgdW5kZXIgdGhlIEdQTHYyIGxpY2Vuc2UuDQogKiBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTIuMC5odG1sDQogKg0KICogQ29udHJpYnV0aW5nIGF1dGhvcjogVHlsZXIgU21pdGggKEBtYm11ZmZmaW4pDQogKi8NCg0KOyhmdW5jdGlvbiAoJCkgew0KDQogIC8vRmxleFNsaWRlcjogT2JqZWN0IEluc3RhbmNlDQogICQuZmxleHNsaWRlciA9IGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7DQogICAgdmFyIHNsaWRlciA9ICQoZWwpLA0KICAgICAgICB2YXJzID0gJC5leHRlbmQoe30sICQuZmxleHNsaWRlci5kZWZhdWx0cywgb3B0aW9ucyksDQogICAgICAgIG5hbWVzcGFjZSA9IHZhcnMubmFtZXNwYWNlLA0KICAgICAgICB0b3VjaCA9ICgib250b3VjaHN0YXJ0IiBpbiB3aW5kb3cpIHx8IHdpbmRvdy5Eb2N1bWVudFRvdWNoICYmIGRvY3VtZW50IGluc3RhbmNlb2YgRG9jdW1lbnRUb3VjaCwNCiAgICAgICAgZXZlbnRUeXBlID0gKHRvdWNoKSA/ICJ0b3VjaGVuZCIgOiAiY2xpY2siLA0KICAgICAgICB2ZXJ0aWNhbCA9IHZhcnMuZGlyZWN0aW9uID09PSAidmVydGljYWwiLA0KICAgICAgICByZXZlcnNlID0gdmFycy5yZXZlcnNlLA0KICAgICAgICBjYXJvdXNlbCA9ICh2YXJzLml0ZW1XaWR0aCA+IDApLA0KICAgICAgICBmYWRlID0gdmFycy5hbmltYXRpb24gPT09ICJmYWRlIiwNCiAgICAgICAgYXNOYXYgPSB2YXJzLmFzTmF2Rm9yICE9PSAiIiwNCiAgICAgICAgbWV0aG9kcyA9IHt9Ow0KICAgIA0KICAgIC8vIFN0b3JlIGEgcmVmZXJlbmNlIHRvIHRoZSBzbGlkZXIgb2JqZWN0DQogICAgJC5kYXRhKGVsLCAiZmxleHNsaWRlciIsIHNsaWRlcik7DQogICAgDQogICAgLy8gUHJpdmF0IHNsaWRlciBtZXRob2RzDQogICAgbWV0aG9kcyA9IHsNCiAgICAgIGluaXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICBzbGlkZXIuYW5pbWF0aW5nID0gZmFsc2U7DQogICAgICAgIHNsaWRlci5jdXJyZW50U2xpZGUgPSB2YXJzLnN0YXJ0QXQ7DQogICAgICAgIHNsaWRlci5hbmltYXRpbmdUbyA9IHNsaWRlci5jdXJyZW50U2xpZGU7DQogICAgICAgIHNsaWRlci5hdEVuZCA9IChzbGlkZXIuY3VycmVudFNsaWRlID09PSAwIHx8IHNsaWRlci5jdXJyZW50U2xpZGUgPT09IHNsaWRlci5sYXN0KTsNCiAgICAgICAgc2xpZGVyLmNvbnRhaW5lclNlbGVjdG9yID0gdmFycy5zZWxlY3Rvci5zdWJzdHIoMCx2YXJzLnNlbGVjdG9yLnNlYXJjaCgnICcpKTsNCiAgICAgICAgc2xpZGVyLnNsaWRlcyA9ICQodmFycy5zZWxlY3Rvciwgc2xpZGVyKTsNCiAgICAgICAgc2xpZGVyLmNvbnRhaW5lciA9ICQoc2xpZGVyLmNvbnRhaW5lclNlbGVjdG9yLCBzbGlkZXIpOw0KICAgICAgICBzbGlkZXIuY291bnQgPSBzbGlkZXIuc2xpZGVzLmxlbmd0aDsNCiAgICAgICAgLy8gU1lOQzoNCiAgICAgICAgc2xpZGVyLnN5bmNFeGlzdHMgPSAkKHZhcnMuc3luYykubGVuZ3RoID4gMDsNCiAgICAgICAgLy8gU0xJREU6DQogICAgICAgIGlmICh2YXJzLmFuaW1hdGlvbiA9PT0gInNsaWRlIikgdmFycy5hbmltYXRpb24gPSAic3dpbmciOw0KICAgICAgICBzbGlkZXIucHJvcCA9ICh2ZXJ0aWNhbCkgPyAidG9wIiA6ICJtYXJnaW5MZWZ0IjsNCiAgICAgICAgc2xpZGVyLmFyZ3MgPSB7fTsNCiAgICAgICAgLy8gU0xJREVTSE9XOg0KICAgICAgICBzbGlkZXIubWFudWFsUGF1c2UgPSBmYWxzZTsNCiAgICAgICAgLy8gVE9VQ0gvVVNFQ1NTOg0KICAgICAgICBzbGlkZXIudHJhbnNpdGlvbnMgPSAhdmFycy52aWRlbyAmJiAhZmFkZSAmJiB2YXJzLnVzZUNTUyAmJiAoZnVuY3Rpb24oKSB7DQogICAgICAgICAgdmFyIG9iaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLA0KICAgICAgICAgICAgICBwcm9wcyA9IFsncGVyc3BlY3RpdmVQcm9wZXJ0eScsICdXZWJraXRQZXJzcGVjdGl2ZScsICdNb3pQZXJzcGVjdGl2ZScsICdPUGVyc3BlY3RpdmUnLCAnbXNQZXJzcGVjdGl2ZSddOw0KICAgICAgICAgIGZvciAodmFyIGkgaW4gcHJvcHMpIHsNCiAgICAgICAgICAgIGlmICggb2JqLnN0eWxlWyBwcm9wc1tpXSBdICE9PSB1bmRlZmluZWQgKSB7DQogICAgICAgICAgICAgIHNsaWRlci5wZnggPSBwcm9wc1tpXS5yZXBsYWNlKCdQZXJzcGVjdGl2ZScsJycpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgIHNsaWRlci5wcm9wID0gIi0iICsgc2xpZGVyLnBmeCArICItdHJhbnNmb3JtIjsNCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSgpKTsNCiAgICAgICAgLy8gQ09OVFJPTFNDT05UQUlORVI6DQogICAgICAgIGlmICh2YXJzLmNvbnRyb2xzQ29udGFpbmVyICE9PSAiIikgc2xpZGVyLmNvbnRyb2xzQ29udGFpbmVyID0gJCh2YXJzLmNvbnRyb2xzQ29udGFpbmVyKS5sZW5ndGggPiAwICYmICQodmFycy5jb250cm9sc0NvbnRhaW5lcik7DQogICAgICAgIC8vIE1BTlVBTDoNCiAgICAgICAgaWYgKHZhcnMubWFudWFsQ29udHJvbHMgIT09ICIiKSBzbGlkZXIubWFudWFsQ29udHJvbHMgPSAkKHZhcnMubWFudWFsQ29udHJvbHMpLmxlbmd0aCA+IDAgJiYgJCh2YXJzLm1hbnVhbENvbnRyb2xzKTsNCiAgICAgICAgDQogICAgICAgIC8vIFJBTkRPTUlaRToNCiAgICAgICAgaWYgKHZhcnMucmFuZG9taXplKSB7DQogICAgICAgICAgc2xpZGVyLnNsaWRlcy5zb3J0KGZ1bmN0aW9uKCkgeyByZXR1cm4gKE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSktMC41KTsgfSk7DQogICAgICAgICAgc2xpZGVyLmNvbnRhaW5lci5lbXB0eSgpLmFwcGVuZChzbGlkZXIuc2xpZGVzKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgc2xpZGVyLmRvTWF0aCgpOw0KICAgICAgICANCiAgICAgICAgLy8gQVNOQVY6DQogICAgICAgIGlmIChhc05hdikgbWV0aG9kcy5hc05hdi5zZXR1cCgpOw0KICAgICAgICANCiAgICAgICAgLy8gSU5JVA0KICAgICAgICBzbGlkZXIuc2V0dXAoImluaXQiKTsNCiAgICAgICAgDQogICAgICAgIC8vIENPTlRST0xOQVY6DQogICAgICAgIGlmICh2YXJzLmNvbnRyb2xOYXYpIG1ldGhvZHMuY29udHJvbE5hdi5zZXR1cCgpOw0KICAgICAgICANCiAgICAgICAgLy8gRElSRUNUSU9OTkFWOg0KICAgICAgICBpZiAodmFycy5kaXJlY3Rpb25OYXYpIG1ldGhvZHMuZGlyZWN0aW9uTmF2LnNldHVwKCk7DQogICAgICAgIA0KICAgICAgICAvLyBLRVlCT0FSRDoNCiAgICAgICAgaWYgKHZhcnMua2V5Ym9hcmQgJiYgKCQoc2xpZGVyLmNvbnRhaW5lclNlbGVjdG9yKS5sZW5ndGggPT09IDEgfHwgdmFycy5tdWx0aXBsZUtleWJvYXJkKSkgew0KICAgICAgICAgICQoZG9jdW1lbnQpLmJpbmQoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIHZhciBrZXljb2RlID0gZXZlbnQua2V5Q29kZTsNCiAgICAgICAgICAgIGlmICghc2xpZGVyLmFuaW1hdGluZyAmJiAoa2V5Y29kZSA9PT0gMzkgfHwga2V5Y29kZSA9PT0gMzcpKSB7DQogICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAoa2V5Y29kZSA9PT0gMzkpID8gc2xpZGVyLmdldFRhcmdldCgnbmV4dCcpIDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIChrZXljb2RlID09PSAzNykgPyBzbGlkZXIuZ2V0VGFyZ2V0KCdwcmV2JykgOiBmYWxzZTsNCiAgICAgICAgICAgICAgc2xpZGVyLmZsZXhBbmltYXRlKHRhcmdldCwgdmFycy5wYXVzZU9uQWN0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBNT1VTRVdIRUVMOg0KICAgICAgICBpZiAodmFycy5tb3VzZXdoZWVsKSB7DQogICAgICAgICAgc2xpZGVyLmJpbmQoJ21vdXNld2hlZWwnLCBmdW5jdGlvbihldmVudCwgZGVsdGEsIGRlbHRhWCwgZGVsdGFZKSB7DQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgdmFyIHRhcmdldCA9IChkZWx0YSA8IDApID8gc2xpZGVyLmdldFRhcmdldCgnbmV4dCcpIDogc2xpZGVyLmdldFRhcmdldCgncHJldicpOw0KICAgICAgICAgICAgc2xpZGVyLmZsZXhBbmltYXRlKHRhcmdldCwgdmFycy5wYXVzZU9uQWN0aW9uKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gUEFVU0VQTEFZDQogICAgICAgIGlmICh2YXJzLnBhdXNlUGxheSkgbWV0aG9kcy5wYXVzZVBsYXkuc2V0dXAoKTsNCiAgICAgICAgDQogICAgICAgIC8vIFNMSURTRVNIT1cNCiAgICAgICAgaWYgKHZhcnMuc2xpZGVzaG93KSB7DQogICAgICAgICAgaWYgKHZhcnMucGF1c2VPbkhvdmVyKSB7DQogICAgICAgICAgICBzbGlkZXIuaG92ZXIoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgIGlmICghc2xpZGVyLm1hbnVhbFBsYXkgJiYgIXNsaWRlci5tYW51YWxQYXVzZSkgc2xpZGVyLnBhdXNlKCk7DQogICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgaWYgKCFzbGlkZXIubWFudWFsUGF1c2UgJiYgIXNsaWRlci5tYW51YWxQbGF5KSBzbGlkZXIucGxheSgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIC8vIGluaXRpYWxpemUgYW5pbWF0aW9uDQogICAgICAgICAgKHZhcnMuaW5pdERlbGF5ID4gMCkgPyBzZXRUaW1lb3V0KHNsaWRlci5wbGF5LCB2YXJzLmluaXREZWxheSkgOiBzbGlkZXIucGxheSgpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBUT1VDSA0KICAgICAgICBpZiAodG91Y2ggJiYgdmFycy50b3VjaCkgbWV0aG9kcy50b3VjaCgpOw0KICAgICAgICANCiAgICAgICAgLy8gRkFERSYmU01PT1RISEVJR0hUIHx8IFNMSURFOg0KICAgICAgICBpZiAoIWZhZGUgfHwgKGZhZGUgJiYgdmFycy5zbW9vdGhIZWlnaHQpKSAkKHdpbmRvdykuYmluZCgicmVzaXplIGZvY3VzIiwgbWV0aG9kcy5yZXNpemUpOw0KICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8vIEFQSTogc3RhcnQoKSBDYWxsYmFjaw0KICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQogICAgICAgICAgdmFycy5zdGFydChzbGlkZXIpOw0KICAgICAgICB9LCAyMDApOw0KICAgICAgfSwNCiAgICAgIGFzTmF2OiB7DQogICAgICAgIHNldHVwOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICBzbGlkZXIuYXNOYXYgPSB0cnVlOw0KICAgICAgICAgIHNsaWRlci5hbmltYXRpbmdUbyA9IE1hdGguZmxvb3Ioc2xpZGVyLmN1cnJlbnRTbGlkZS9zbGlkZXIubW92ZSk7DQogICAgICAgICAgc2xpZGVyLmN1cnJlbnRJdGVtID0gc2xpZGVyLmN1cnJlbnRTbGlkZTsNCiAgICAgICAgICBzbGlkZXIuc2xpZGVzLnJlbW92ZUNsYXNzKG5hbWVzcGFjZSArICJhY3RpdmUtc2xpZGUiKS5lcShzbGlkZXIuY3VycmVudEl0ZW0pLmFkZENsYXNzKG5hbWVzcGFjZSArICJhY3RpdmUtc2xpZGUiKTsNCiAgICAgICAgICBzbGlkZXIuc2xpZGVzLmNsaWNrKGZ1bmN0aW9uKGUpew0KICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgdmFyICRzbGlkZSA9ICQodGhpcyksDQogICAgICAgICAgICAgICAgdGFyZ2V0ID0gJHNsaWRlLmluZGV4KCk7DQogICAgICAgICAgICBpZiAoISQodmFycy5hc05hdkZvcikuZGF0YSgnZmxleHNsaWRlcicpLmFuaW1hdGluZyAmJiAhJHNsaWRlLmhhc0NsYXNzKCdhY3RpdmUnKSkgew0KICAgICAgICAgICAgICBzbGlkZXIuZGlyZWN0aW9uID0gKHNsaWRlci5jdXJyZW50SXRlbSA8IHRhcmdldCkgPyAibmV4dCIgOiAicHJldiI7DQogICAgICAgICAgICAgIHNsaWRlci5mbGV4QW5pbWF0ZSh0YXJnZXQsIHZhcnMucGF1c2VPbkFjdGlvbiwgZmFsc2UsIHRydWUsIHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgY29udHJvbE5hdjogew0KICAgICAgICBzZXR1cDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgaWYgKCFzbGlkZXIubWFudWFsQ29udHJvbHMpIHsNCiAgICAgICAgICAgIG1ldGhvZHMuY29udHJvbE5hdi5zZXR1cFBhZ2luZygpOw0KICAgICAgICAgIH0gZWxzZSB7IC8vIE1BTlVBTENPTlRST0xTOg0KICAgICAgICAgICAgbWV0aG9kcy5jb250cm9sTmF2LnNldHVwTWFudWFsKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBzZXR1cFBhZ2luZzogZnVuY3Rpb24oKSB7DQogICAgICAgICAgdmFyIHR5cGUgPSAodmFycy5jb250cm9sTmF2ID09PSAidGh1bWJuYWlscyIpID8gJ2NvbnRyb2wtdGh1bWJzJyA6ICdjb250cm9sLXBhZ2luZycsDQogICAgICAgICAgICAgIGogPSAxLA0KICAgICAgICAgICAgICBpdGVtOw0KICAgICAgICAgIA0KICAgICAgICAgIHNsaWRlci5jb250cm9sTmF2U2NhZmZvbGQgPSAkKCc8b2wgY2xhc3M9IicrIG5hbWVzcGFjZSArICdjb250cm9sLW5hdiAnICsgbmFtZXNwYWNlICsgdHlwZSArICciPjwvb2w+Jyk7DQogICAgICAgICAgDQogICAgICAgICAgaWYgKHNsaWRlci5wYWdpbmdDb3VudCA+IDEpIHsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpZGVyLnBhZ2luZ0NvdW50OyBpKyspIHsNCiAgICAgICAgICAgICAgaXRlbSA9ICh2YXJzLmNvbnRyb2xOYXYgPT09ICJ0aHVtYm5haWxzIikgPyAnPGltZyBzcmM9IicgKyBzbGlkZXIuc2xpZGVzLmVxKGkpLmF0dHIoImRhdGEtdGh1bWIiKSArICciLz4nIDogJzxhPicgKyBqICsgJzwvYT4nOw0KICAgICAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdlNjYWZmb2xkLmFwcGVuZCgnPGxpPicgKyBpdGVtICsgJzwvbGk+Jyk7DQogICAgICAgICAgICAgIGorKzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgDQogICAgICAgICAgLy8gQ09OVFJPTFNDT05UQUlORVI6DQogICAgICAgICAgKHNsaWRlci5jb250cm9sc0NvbnRhaW5lcikgPyAkKHNsaWRlci5jb250cm9sc0NvbnRhaW5lcikuYXBwZW5kKHNsaWRlci5jb250cm9sTmF2U2NhZmZvbGQpIDogc2xpZGVyLmFwcGVuZChzbGlkZXIuY29udHJvbE5hdlNjYWZmb2xkKTsNCiAgICAgICAgICBtZXRob2RzLmNvbnRyb2xOYXYuc2V0KCk7DQogICAgICAgICAgDQogICAgICAgICAgbWV0aG9kcy5jb250cm9sTmF2LmFjdGl2ZSgpOw0KICAgICAgICANCiAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdlNjYWZmb2xkLmRlbGVnYXRlKCdhLCBpbWcnLCBldmVudFR5cGUsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSwNCiAgICAgICAgICAgICAgICB0YXJnZXQgPSBzbGlkZXIuY29udHJvbE5hdi5pbmRleCgkdGhpcyk7DQoNCiAgICAgICAgICAgIGlmICghJHRoaXMuaGFzQ2xhc3MobmFtZXNwYWNlICsgJ2FjdGl2ZScpKSB7DQogICAgICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb24gPSAodGFyZ2V0ID4gc2xpZGVyLmN1cnJlbnRTbGlkZSkgPyAibmV4dCIgOiAicHJldiI7DQogICAgICAgICAgICAgIHNsaWRlci5mbGV4QW5pbWF0ZSh0YXJnZXQsIHZhcnMucGF1c2VPbkFjdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgICAgLy8gUHJldmVudCBpT1MgY2xpY2sgZXZlbnQgYnVnDQogICAgICAgICAgaWYgKHRvdWNoKSB7DQogICAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdlNjYWZmb2xkLmRlbGVnYXRlKCdhJywgImNsaWNrIHRvdWNoc3RhcnQiLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBzZXR1cE1hbnVhbDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXYgPSBzbGlkZXIubWFudWFsQ29udHJvbHM7DQogICAgICAgICAgbWV0aG9kcy5jb250cm9sTmF2LmFjdGl2ZSgpOw0KICAgICAgICAgIA0KICAgICAgICAgIHNsaWRlci5jb250cm9sTmF2LmxpdmUoZXZlbnRUeXBlLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksDQogICAgICAgICAgICAgICAgdGFyZ2V0ID0gc2xpZGVyLmNvbnRyb2xOYXYuaW5kZXgoJHRoaXMpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKCEkdGhpcy5oYXNDbGFzcyhuYW1lc3BhY2UgKyAnYWN0aXZlJykpIHsNCiAgICAgICAgICAgICAgKHRhcmdldCA+IHNsaWRlci5jdXJyZW50U2xpZGUpID8gc2xpZGVyLmRpcmVjdGlvbiA9ICJuZXh0IiA6IHNsaWRlci5kaXJlY3Rpb24gPSAicHJldiI7DQogICAgICAgICAgICAgIHNsaWRlci5mbGV4QW5pbWF0ZSh0YXJnZXQsIHZhcnMucGF1c2VPbkFjdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgICAgLy8gUHJldmVudCBpT1MgY2xpY2sgZXZlbnQgYnVnDQogICAgICAgICAgaWYgKHRvdWNoKSB7DQogICAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdi5saXZlKCJjbGljayB0b3VjaHN0YXJ0IiwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgc2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICB2YXIgc2VsZWN0b3IgPSAodmFycy5jb250cm9sTmF2ID09PSAidGh1bWJuYWlscyIpID8gJ2ltZycgOiAnYSc7DQogICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXYgPSAkKCcuJyArIG5hbWVzcGFjZSArICdjb250cm9sLW5hdiBsaSAnICsgc2VsZWN0b3IsIChzbGlkZXIuY29udHJvbHNDb250YWluZXIpID8gc2xpZGVyLmNvbnRyb2xzQ29udGFpbmVyIDogc2xpZGVyKTsNCiAgICAgICAgfSwNCiAgICAgICAgYWN0aXZlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdi5yZW1vdmVDbGFzcyhuYW1lc3BhY2UgKyAiYWN0aXZlIikuZXEoc2xpZGVyLmFuaW1hdGluZ1RvKS5hZGRDbGFzcyhuYW1lc3BhY2UgKyAiYWN0aXZlIik7DQogICAgICAgIH0sDQogICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oYWN0aW9uLCBwb3MpIHsNCiAgICAgICAgICBpZiAoc2xpZGVyLnBhZ2luZ0NvdW50ID4gMSAmJiBhY3Rpb24gPT09ICJhZGQiKSB7DQogICAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdlNjYWZmb2xkLmFwcGVuZCgkKCc8bGk+PGE+JyArIHNsaWRlci5jb3VudCArICc8L2E+PC9saT4nKSk7DQogICAgICAgICAgfSBlbHNlIGlmIChzbGlkZXIucGFnaW5nQ291bnQgPT09IDEpIHsNCiAgICAgICAgICAgIHNsaWRlci5jb250cm9sTmF2U2NhZmZvbGQuZmluZCgnbGknKS5yZW1vdmUoKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXYuZXEocG9zKS5jbG9zZXN0KCdsaScpLnJlbW92ZSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBtZXRob2RzLmNvbnRyb2xOYXYuc2V0KCk7DQogICAgICAgICAgKHNsaWRlci5wYWdpbmdDb3VudCA+IDEgJiYgc2xpZGVyLnBhZ2luZ0NvdW50ICE9PSBzbGlkZXIuY29udHJvbE5hdi5sZW5ndGgpID8gc2xpZGVyLnVwZGF0ZShwb3MsIGFjdGlvbikgOiBtZXRob2RzLmNvbnRyb2xOYXYuYWN0aXZlKCk7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICBkaXJlY3Rpb25OYXY6IHsNCiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHZhciBkaXJlY3Rpb25OYXZTY2FmZm9sZCA9ICQoJzx1bCBjbGFzcz0iJyArIG5hbWVzcGFjZSArICdkaXJlY3Rpb24tbmF2Ij48bGk+PGEgY2xhc3M9IicgKyBuYW1lc3BhY2UgKyAncHJldiIgaHJlZj0iIyI+JyArIHZhcnMucHJldlRleHQgKyAnPC9hPjwvbGk+PGxpPjxhIGNsYXNzPSInICsgbmFtZXNwYWNlICsgJ25leHQiIGhyZWY9IiMiPicgKyB2YXJzLm5leHRUZXh0ICsgJzwvYT48L2xpPjwvdWw+Jyk7DQogICAgICAgIA0KICAgICAgICAgIC8vIENPTlRST0xTQ09OVEFJTkVSOg0KICAgICAgICAgIGlmIChzbGlkZXIuY29udHJvbHNDb250YWluZXIpIHsNCiAgICAgICAgICAgICQoc2xpZGVyLmNvbnRyb2xzQ29udGFpbmVyKS5hcHBlbmQoZGlyZWN0aW9uTmF2U2NhZmZvbGQpOw0KICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdiA9ICQoJy4nICsgbmFtZXNwYWNlICsgJ2RpcmVjdGlvbi1uYXYgbGkgYScsIHNsaWRlci5jb250cm9sc0NvbnRhaW5lcik7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlci5hcHBlbmQoZGlyZWN0aW9uTmF2U2NhZmZvbGQpOw0KICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdiA9ICQoJy4nICsgbmFtZXNwYWNlICsgJ2RpcmVjdGlvbi1uYXYgbGkgYScsIHNsaWRlcik7DQogICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgICBtZXRob2RzLmRpcmVjdGlvbk5hdi51cGRhdGUoKTsNCiAgICAgICAgDQogICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdi5iaW5kKGV2ZW50VHlwZSwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gKCQodGhpcykuaGFzQ2xhc3MobmFtZXNwYWNlICsgJ25leHQnKSkgPyBzbGlkZXIuZ2V0VGFyZ2V0KCduZXh0JykgOiBzbGlkZXIuZ2V0VGFyZ2V0KCdwcmV2Jyk7DQogICAgICAgICAgICBzbGlkZXIuZmxleEFuaW1hdGUodGFyZ2V0LCB2YXJzLnBhdXNlT25BY3Rpb24pOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIC8vIFByZXZlbnQgaU9TIGNsaWNrIGV2ZW50IGJ1Zw0KICAgICAgICAgIGlmICh0b3VjaCkgew0KICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdi5iaW5kKCJjbGljayB0b3VjaHN0YXJ0IiwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICB2YXIgZGlzYWJsZWRDbGFzcyA9IG5hbWVzcGFjZSArICdkaXNhYmxlZCc7DQogICAgICAgICAgaWYgKHNsaWRlci5wYWdpbmdDb3VudCA9PT0gMSkgew0KICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdi5hZGRDbGFzcyhkaXNhYmxlZENsYXNzKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKCF2YXJzLmFuaW1hdGlvbkxvb3ApIHsNCiAgICAgICAgICAgIGlmIChzbGlkZXIuYW5pbWF0aW5nVG8gPT09IDApIHsNCiAgICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdi5yZW1vdmVDbGFzcyhkaXNhYmxlZENsYXNzKS5maWx0ZXIoJy4nICsgbmFtZXNwYWNlICsgInByZXYiKS5hZGRDbGFzcyhkaXNhYmxlZENsYXNzKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2xpZGVyLmFuaW1hdGluZ1RvID09PSBzbGlkZXIubGFzdCkgew0KICAgICAgICAgICAgICBzbGlkZXIuZGlyZWN0aW9uTmF2LnJlbW92ZUNsYXNzKGRpc2FibGVkQ2xhc3MpLmZpbHRlcignLicgKyBuYW1lc3BhY2UgKyAibmV4dCIpLmFkZENsYXNzKGRpc2FibGVkQ2xhc3MpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdi5yZW1vdmVDbGFzcyhkaXNhYmxlZENsYXNzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdi5yZW1vdmVDbGFzcyhkaXNhYmxlZENsYXNzKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICBwYXVzZVBsYXk6IHsNCiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHZhciBwYXVzZVBsYXlTY2FmZm9sZCA9ICQoJzxkaXYgY2xhc3M9IicgKyBuYW1lc3BhY2UgKyAncGF1c2VwbGF5Ij48YT48L2E+PC9kaXY+Jyk7DQogICAgICAgIA0KICAgICAgICAgIC8vIENPTlRST0xTQ09OVEFJTkVSOg0KICAgICAgICAgIGlmIChzbGlkZXIuY29udHJvbHNDb250YWluZXIpIHsNCiAgICAgICAgICAgIHNsaWRlci5jb250cm9sc0NvbnRhaW5lci5hcHBlbmQocGF1c2VQbGF5U2NhZmZvbGQpOw0KICAgICAgICAgICAgc2xpZGVyLnBhdXNlUGxheSA9ICQoJy4nICsgbmFtZXNwYWNlICsgJ3BhdXNlcGxheSBhJywgc2xpZGVyLmNvbnRyb2xzQ29udGFpbmVyKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2xpZGVyLmFwcGVuZChwYXVzZVBsYXlTY2FmZm9sZCk7DQogICAgICAgICAgICBzbGlkZXIucGF1c2VQbGF5ID0gJCgnLicgKyBuYW1lc3BhY2UgKyAncGF1c2VwbGF5IGEnLCBzbGlkZXIpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIG1ldGhvZHMucGF1c2VQbGF5LnVwZGF0ZSgodmFycy5zbGlkZXNob3cpID8gbmFtZXNwYWNlICsgJ3BhdXNlJyA6IG5hbWVzcGFjZSArICdwbGF5Jyk7DQoNCiAgICAgICAgICBzbGlkZXIucGF1c2VQbGF5LmJpbmQoZXZlbnRUeXBlLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKG5hbWVzcGFjZSArICdwYXVzZScpKSB7DQogICAgICAgICAgICAgIHNsaWRlci5tYW51YWxQYXVzZSA9IHRydWU7DQogICAgICAgICAgICAgIHNsaWRlci5tYW51YWxQbGF5ID0gZmFsc2U7DQogICAgICAgICAgICAgIHNsaWRlci5wYXVzZSgpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgc2xpZGVyLm1hbnVhbFBhdXNlID0gZmFsc2U7DQogICAgICAgICAgICAgIHNsaWRlci5tYW51YWxQbGF5ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgc2xpZGVyLnBsYXkoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgICAvLyBQcmV2ZW50IGlPUyBjbGljayBldmVudCBidWcNCiAgICAgICAgICBpZiAodG91Y2gpIHsNCiAgICAgICAgICAgIHNsaWRlci5wYXVzZVBsYXkuYmluZCgiY2xpY2sgdG91Y2hzdGFydCIsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oc3RhdGUpIHsNCiAgICAgICAgICAoc3RhdGUgPT09ICJwbGF5IikgPyBzbGlkZXIucGF1c2VQbGF5LnJlbW92ZUNsYXNzKG5hbWVzcGFjZSArICdwYXVzZScpLmFkZENsYXNzKG5hbWVzcGFjZSArICdwbGF5JykudGV4dCh2YXJzLnBsYXlUZXh0KSA6IHNsaWRlci5wYXVzZVBsYXkucmVtb3ZlQ2xhc3MobmFtZXNwYWNlICsgJ3BsYXknKS5hZGRDbGFzcyhuYW1lc3BhY2UgKyAncGF1c2UnKS50ZXh0KHZhcnMucGF1c2VUZXh0KTsNCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIHRvdWNoOiBmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIHN0YXJ0WCwNCiAgICAgICAgICBzdGFydFksDQogICAgICAgICAgb2Zmc2V0LA0KICAgICAgICAgIGN3aWR0aCwNCiAgICAgICAgICBkeCwNCiAgICAgICAgICBzdGFydFQsDQogICAgICAgICAgc2Nyb2xsaW5nID0gZmFsc2U7DQogICAgICAgICAgICAgIA0KICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgb25Ub3VjaFN0YXJ0LCBmYWxzZSk7DQogICAgICAgIGZ1bmN0aW9uIG9uVG91Y2hTdGFydChlKSB7DQogICAgICAgICAgaWYgKHNsaWRlci5hbmltYXRpbmcpIHsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAgIHNsaWRlci5wYXVzZSgpOw0KICAgICAgICAgICAgLy8gQ0FST1VTRUw6IA0KICAgICAgICAgICAgY3dpZHRoID0gKHZlcnRpY2FsKSA/IHNsaWRlci5oIDogc2xpZGVyLiB3Ow0KICAgICAgICAgICAgc3RhcnRUID0gTnVtYmVyKG5ldyBEYXRlKCkpOw0KICAgICAgICAgICAgLy8gQ0FST1VTRUw6DQogICAgICAgICAgICBvZmZzZXQgPSAoY2Fyb3VzZWwgJiYgcmV2ZXJzZSAmJiBzbGlkZXIuYW5pbWF0aW5nVG8gPT09IHNsaWRlci5sYXN0KSA/IDAgOg0KICAgICAgICAgICAgICAgICAgICAgKGNhcm91c2VsICYmIHJldmVyc2UpID8gc2xpZGVyLmxpbWl0IC0gKCgoc2xpZGVyLml0ZW1XICsgdmFycy5pdGVtTWFyZ2luKSAqIHNsaWRlci5tb3ZlKSAqIHNsaWRlci5hbmltYXRpbmdUbykgOg0KICAgICAgICAgICAgICAgICAgICAgKGNhcm91c2VsICYmIHNsaWRlci5jdXJyZW50U2xpZGUgPT09IHNsaWRlci5sYXN0KSA/IHNsaWRlci5saW1pdCA6DQogICAgICAgICAgICAgICAgICAgICAoY2Fyb3VzZWwpID8gKChzbGlkZXIuaXRlbVcgKyB2YXJzLml0ZW1NYXJnaW4pICogc2xpZGVyLm1vdmUpICogc2xpZGVyLmN1cnJlbnRTbGlkZSA6IA0KICAgICAgICAgICAgICAgICAgICAgKHJldmVyc2UpID8gKHNsaWRlci5sYXN0IC0gc2xpZGVyLmN1cnJlbnRTbGlkZSArIHNsaWRlci5jbG9uZU9mZnNldCkgKiBjd2lkdGggOiAoc2xpZGVyLmN1cnJlbnRTbGlkZSArIHNsaWRlci5jbG9uZU9mZnNldCkgKiBjd2lkdGg7DQogICAgICAgICAgICBzdGFydFggPSAodmVydGljYWwpID8gZS50b3VjaGVzWzBdLnBhZ2VZIDogZS50b3VjaGVzWzBdLnBhZ2VYOw0KICAgICAgICAgICAgc3RhcnRZID0gKHZlcnRpY2FsKSA/IGUudG91Y2hlc1swXS5wYWdlWCA6IGUudG91Y2hlc1swXS5wYWdlWTsNCg0KICAgICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgb25Ub3VjaE1vdmUsIGZhbHNlKTsNCiAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgb25Ub3VjaEVuZCwgZmFsc2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIG9uVG91Y2hNb3ZlKGUpIHsNCiAgICAgICAgICBkeCA9ICh2ZXJ0aWNhbCkgPyBzdGFydFggLSBlLnRvdWNoZXNbMF0ucGFnZVkgOiBzdGFydFggLSBlLnRvdWNoZXNbMF0ucGFnZVg7DQogICAgICAgICAgc2Nyb2xsaW5nID0gKHZlcnRpY2FsKSA/IChNYXRoLmFicyhkeCkgPCBNYXRoLmFicyhlLnRvdWNoZXNbMF0ucGFnZVggLSBzdGFydFkpKSA6IChNYXRoLmFicyhkeCkgPCBNYXRoLmFicyhlLnRvdWNoZXNbMF0ucGFnZVkgLSBzdGFydFkpKTsNCiAgICAgICAgICANCiAgICAgICAgICBpZiAoIXNjcm9sbGluZyB8fCBOdW1iZXIobmV3IERhdGUoKSkgLSBzdGFydFQgPiA1MDApIHsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGlmICghZmFkZSAmJiBzbGlkZXIudHJhbnNpdGlvbnMpIHsNCiAgICAgICAgICAgICAgaWYgKCF2YXJzLmFuaW1hdGlvbkxvb3ApIHsNCiAgICAgICAgICAgICAgICBkeCA9IGR4Lygoc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gMCAmJiBkeCA8IDAgfHwgc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gc2xpZGVyLmxhc3QgJiYgZHggPiAwKSA/IChNYXRoLmFicyhkeCkvY3dpZHRoKzIpIDogMSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgc2xpZGVyLnNldFByb3BzKG9mZnNldCArIGR4LCAic2V0VG91Y2giKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGZ1bmN0aW9uIG9uVG91Y2hFbmQoZSkgew0KICAgICAgICAgIC8vIGZpbmlzaCB0aGUgdG91Y2ggYnkgdW5kb2luZyB0aGUgdG91Y2ggc2Vzc2lvbg0KICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIG9uVG91Y2hNb3ZlLCBmYWxzZSk7DQogICAgICAgICAgDQogICAgICAgICAgaWYgKHNsaWRlci5hbmltYXRpbmdUbyA9PT0gc2xpZGVyLmN1cnJlbnRTbGlkZSAmJiAhc2Nyb2xsaW5nICYmICEoZHggPT09IG51bGwpKSB7DQogICAgICAgICAgICB2YXIgdXBkYXRlRHggPSAocmV2ZXJzZSkgPyAtZHggOiBkeCwNCiAgICAgICAgICAgICAgICB0YXJnZXQgPSAodXBkYXRlRHggPiAwKSA/IHNsaWRlci5nZXRUYXJnZXQoJ25leHQnKSA6IHNsaWRlci5nZXRUYXJnZXQoJ3ByZXYnKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHNsaWRlci5jYW5BZHZhbmNlKHRhcmdldCkgJiYgKE51bWJlcihuZXcgRGF0ZSgpKSAtIHN0YXJ0VCA8IDU1MCAmJiBNYXRoLmFicyh1cGRhdGVEeCkgPiA1MCB8fCBNYXRoLmFicyh1cGRhdGVEeCkgPiBjd2lkdGgvMikpIHsNCiAgICAgICAgICAgICAgc2xpZGVyLmZsZXhBbmltYXRlKHRhcmdldCwgdmFycy5wYXVzZU9uQWN0aW9uKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGlmICghZmFkZSkgc2xpZGVyLmZsZXhBbmltYXRlKHNsaWRlci5jdXJyZW50U2xpZGUsIHZhcnMucGF1c2VPbkFjdGlvbiwgdHJ1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgb25Ub3VjaEVuZCwgZmFsc2UpOw0KICAgICAgICAgIHN0YXJ0WCA9IG51bGw7DQogICAgICAgICAgc3RhcnRZID0gbnVsbDsNCiAgICAgICAgICBkeCA9IG51bGw7DQogICAgICAgICAgb2Zmc2V0ID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7DQogICAgICAgIGlmICghc2xpZGVyLmFuaW1hdGluZyAmJiBzbGlkZXIuaXMoJzp2aXNpYmxlJykpIHsNCiAgICAgICAgICBpZiAoIWNhcm91c2VsKSBzbGlkZXIuZG9NYXRoKCk7DQogICAgICAgICAgDQogICAgICAgICAgaWYgKGZhZGUpIHsNCiAgICAgICAgICAgIC8vIFNNT09USCBIRUlHSFQ6DQogICAgICAgICAgICBtZXRob2RzLnNtb290aEhlaWdodCgpOw0KICAgICAgICAgIH0gZWxzZSBpZiAoY2Fyb3VzZWwpIHsgLy9DQVJPVVNFTDoNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMud2lkdGgoc2xpZGVyLmNvbXB1dGVkVyk7DQogICAgICAgICAgICBzbGlkZXIudXBkYXRlKHNsaWRlci5wYWdpbmdDb3VudCk7DQogICAgICAgICAgICBzbGlkZXIuc2V0UHJvcHMoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZWxzZSBpZiAodmVydGljYWwpIHsgLy9WRVJUSUNBTDoNCiAgICAgICAgICAgIHNsaWRlci52aWV3cG9ydC5oZWlnaHQoc2xpZGVyLmgpOw0KICAgICAgICAgICAgc2xpZGVyLnNldFByb3BzKHNsaWRlci5oLCAic2V0VG90YWwiKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gU01PT1RIIEhFSUdIVDoNCiAgICAgICAgICAgIGlmICh2YXJzLnNtb290aEhlaWdodCkgbWV0aG9kcy5zbW9vdGhIZWlnaHQoKTsNCiAgICAgICAgICAgIHNsaWRlci5uZXdTbGlkZXMud2lkdGgoc2xpZGVyLmNvbXB1dGVkVyk7DQogICAgICAgICAgICBzbGlkZXIuc2V0UHJvcHMoc2xpZGVyLmNvbXB1dGVkVywgInNldFRvdGFsIik7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgc21vb3RoSGVpZ2h0OiBmdW5jdGlvbihkdXIpIHsNCiAgICAgICAgaWYgKCF2ZXJ0aWNhbCB8fCBmYWRlKSB7DQogICAgICAgICAgdmFyICRvYmogPSAoZmFkZSkgPyBzbGlkZXIgOiBzbGlkZXIudmlld3BvcnQ7DQogICAgICAgICAgKGR1cikgPyAkb2JqLmFuaW1hdGUoeyJoZWlnaHQiOiBzbGlkZXIuc2xpZGVzLmVxKHNsaWRlci5hbmltYXRpbmdUbykuaGVpZ2h0KCl9LCBkdXIpIDogJG9iai5oZWlnaHQoc2xpZGVyLnNsaWRlcy5lcShzbGlkZXIuYW5pbWF0aW5nVG8pLmhlaWdodCgpKTsNCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIHN5bmM6IGZ1bmN0aW9uKGFjdGlvbikgew0KICAgICAgICB2YXIgJG9iaiA9ICQodmFycy5zeW5jKS5kYXRhKCJmbGV4c2xpZGVyIiksDQogICAgICAgICAgICB0YXJnZXQgPSBzbGlkZXIuYW5pbWF0aW5nVG87DQogICAgICAgIA0KICAgICAgICBzd2l0Y2ggKGFjdGlvbikgew0KICAgICAgICAgIGNhc2UgImFuaW1hdGUiOiAkb2JqLmZsZXhBbmltYXRlKHRhcmdldCwgdmFycy5wYXVzZU9uQWN0aW9uLCBmYWxzZSwgdHJ1ZSk7IGJyZWFrOw0KICAgICAgICAgIGNhc2UgInBsYXkiOiBpZiAoISRvYmoucGxheWluZyAmJiAhJG9iai5hc05hdikgeyAkb2JqLnBsYXkoKTsgfSBicmVhazsNCiAgICAgICAgICBjYXNlICJwYXVzZSI6ICRvYmoucGF1c2UoKTsgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgDQogICAgLy8gcHVibGljIG1ldGhvZHMNCiAgICBzbGlkZXIuZmxleEFuaW1hdGUgPSBmdW5jdGlvbih0YXJnZXQsIHBhdXNlLCBvdmVycmlkZSwgd2l0aFN5bmMsIGZyb21OYXYpIHsNCiAgICAgIGlmIChhc05hdiAmJiBzbGlkZXIucGFnaW5nQ291bnQgPT09IDEpIHNsaWRlci5kaXJlY3Rpb24gPSAoc2xpZGVyLmN1cnJlbnRJdGVtIDwgdGFyZ2V0KSA/ICJuZXh0IiA6ICJwcmV2IjsNCiAgICAgIA0KICAgICAgaWYgKCFzbGlkZXIuYW5pbWF0aW5nICYmIChzbGlkZXIuY2FuQWR2YW5jZSh0YXJnZXQsIGZyb21OYXYpIHx8IG92ZXJyaWRlKSAmJiBzbGlkZXIuaXMoIjp2aXNpYmxlIikpIHsNCiAgICAgICAgaWYgKGFzTmF2ICYmIHdpdGhTeW5jKSB7DQogICAgICAgICAgdmFyIG1hc3RlciA9ICQodmFycy5hc05hdkZvcikuZGF0YSgnZmxleHNsaWRlcicpOw0KICAgICAgICAgIHNsaWRlci5hdEVuZCA9IHRhcmdldCA9PT0gMCB8fCB0YXJnZXQgPT09IHNsaWRlci5jb3VudCAtIDE7DQogICAgICAgICAgbWFzdGVyLmZsZXhBbmltYXRlKHRhcmdldCwgdHJ1ZSwgZmFsc2UsIHRydWUsIGZyb21OYXYpOw0KICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb24gPSAoc2xpZGVyLmN1cnJlbnRJdGVtIDwgdGFyZ2V0KSA/ICJuZXh0IiA6ICJwcmV2IjsNCiAgICAgICAgICBtYXN0ZXIuZGlyZWN0aW9uID0gc2xpZGVyLmRpcmVjdGlvbjsNCiAgICAgICAgICANCiAgICAgICAgICBpZiAoTWF0aC5jZWlsKCh0YXJnZXQgKyAxKS9zbGlkZXIudmlzaWJsZSkgLSAxICE9PSBzbGlkZXIuY3VycmVudFNsaWRlICYmIHRhcmdldCAhPT0gMCkgew0KICAgICAgICAgICAgc2xpZGVyLmN1cnJlbnRJdGVtID0gdGFyZ2V0Ow0KICAgICAgICAgICAgc2xpZGVyLnNsaWRlcy5yZW1vdmVDbGFzcyhuYW1lc3BhY2UgKyAiYWN0aXZlLXNsaWRlIikuZXEodGFyZ2V0KS5hZGRDbGFzcyhuYW1lc3BhY2UgKyAiYWN0aXZlLXNsaWRlIik7DQogICAgICAgICAgICB0YXJnZXQgPSBNYXRoLmZsb29yKHRhcmdldC9zbGlkZXIudmlzaWJsZSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlci5jdXJyZW50SXRlbSA9IHRhcmdldDsNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMucmVtb3ZlQ2xhc3MobmFtZXNwYWNlICsgImFjdGl2ZS1zbGlkZSIpLmVxKHRhcmdldCkuYWRkQ2xhc3MobmFtZXNwYWNlICsgImFjdGl2ZS1zbGlkZSIpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgc2xpZGVyLmFuaW1hdGluZyA9IHRydWU7DQogICAgICAgIHNsaWRlci5hbmltYXRpbmdUbyA9IHRhcmdldDsNCiAgICAgICAgLy8gQVBJOiBiZWZvcmUoKSBhbmltYXRpb24gQ2FsbGJhY2sNCiAgICAgICAgdmFycy5iZWZvcmUoc2xpZGVyKTsNCiAgICAgICAgDQogICAgICAgIC8vIFNMSURFU0hPVzoNCiAgICAgICAgaWYgKHBhdXNlKSBzbGlkZXIucGF1c2UoKTsNCiAgICAgICAgDQogICAgICAgIC8vIFNZTkM6DQogICAgICAgIGlmIChzbGlkZXIuc3luY0V4aXN0cyAmJiAhZnJvbU5hdikgbWV0aG9kcy5zeW5jKCJhbmltYXRlIik7DQogICAgICAgIA0KICAgICAgICAvLyBDT05UUk9MTkFWDQogICAgICAgIGlmICh2YXJzLmNvbnRyb2xOYXYpIG1ldGhvZHMuY29udHJvbE5hdi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgIC8vICFDQVJPVVNFTDoNCiAgICAgICAgLy8gQ0FORElEQVRFOiBzbGlkZSBhY3RpdmUgY2xhc3MgKGZvciBhZGQvcmVtb3ZlIHNsaWRlKQ0KICAgICAgICBpZiAoIWNhcm91c2VsKSBzbGlkZXIuc2xpZGVzLnJlbW92ZUNsYXNzKG5hbWVzcGFjZSArICdhY3RpdmUtc2xpZGUnKS5lcSh0YXJnZXQpLmFkZENsYXNzKG5hbWVzcGFjZSArICdhY3RpdmUtc2xpZGUnKTsNCiAgICAgICAgDQogICAgICAgIC8vIElORklOSVRFIExPT1A6DQogICAgICAgIC8vIENBTkRJREFURTogYXRFbmQNCiAgICAgICAgc2xpZGVyLmF0RW5kID0gdGFyZ2V0ID09PSAwIHx8IHRhcmdldCA9PT0gc2xpZGVyLmxhc3Q7DQogICAgICAgIA0KICAgICAgICAvLyBESVJFQ1RJT05OQVY6DQogICAgICAgIGlmICh2YXJzLmRpcmVjdGlvbk5hdikgbWV0aG9kcy5kaXJlY3Rpb25OYXYudXBkYXRlKCk7DQogICAgICAgIA0KICAgICAgICBpZiAodGFyZ2V0ID09PSBzbGlkZXIubGFzdCkgew0KICAgICAgICAgIC8vIEFQSTogZW5kKCkgb2YgY3ljbGUgQ2FsbGJhY2sNCiAgICAgICAgICB2YXJzLmVuZChzbGlkZXIpOw0KICAgICAgICAgIC8vIFNMSURFU0hPVyAmJiAhSU5GSU5JVEUgTE9PUDoNCiAgICAgICAgICBpZiAoIXZhcnMuYW5pbWF0aW9uTG9vcCkgc2xpZGVyLnBhdXNlKCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFNMSURFOg0KICAgICAgICBpZiAoIWZhZGUpIHsNCiAgICAgICAgICB2YXIgZGltZW5zaW9uID0gKHZlcnRpY2FsKSA/IHNsaWRlci5zbGlkZXMuZmlsdGVyKCc6Zmlyc3QnKS5oZWlnaHQoKSA6IHNsaWRlci5jb21wdXRlZFcsDQogICAgICAgICAgICAgIG1hcmdpbiwgc2xpZGVTdHJpbmcsIGNhbGNOZXh0Ow0KICAgICAgICAgIA0KICAgICAgICAgIC8vIElORklOSVRFIExPT1AgLyBSRVZFUlNFOg0KICAgICAgICAgIGlmIChjYXJvdXNlbCkgew0KICAgICAgICAgICAgbWFyZ2luID0gKHZhcnMuaXRlbVdpZHRoID4gc2xpZGVyLncpID8gdmFycy5pdGVtTWFyZ2luICogMiA6IHZhcnMuaXRlbU1hcmdpbjsNCiAgICAgICAgICAgIGNhbGNOZXh0ID0gKChzbGlkZXIuaXRlbVcgKyBtYXJnaW4pICogc2xpZGVyLm1vdmUpICogc2xpZGVyLmFuaW1hdGluZ1RvOw0KICAgICAgICAgICAgc2xpZGVTdHJpbmcgPSAoY2FsY05leHQgPiBzbGlkZXIubGltaXQgJiYgc2xpZGVyLnZpc2libGUgIT09IDEpID8gc2xpZGVyLmxpbWl0IDogY2FsY05leHQ7DQogICAgICAgICAgfSBlbHNlIGlmIChzbGlkZXIuY3VycmVudFNsaWRlID09PSAwICYmIHRhcmdldCA9PT0gc2xpZGVyLmNvdW50IC0gMSAmJiB2YXJzLmFuaW1hdGlvbkxvb3AgJiYgc2xpZGVyLmRpcmVjdGlvbiAhPT0gIm5leHQiKSB7DQogICAgICAgICAgICBzbGlkZVN0cmluZyA9IChyZXZlcnNlKSA/IChzbGlkZXIuY291bnQgKyBzbGlkZXIuY2xvbmVPZmZzZXQpICogZGltZW5zaW9uIDogMDsNCiAgICAgICAgICB9IGVsc2UgaWYgKHNsaWRlci5jdXJyZW50U2xpZGUgPT09IHNsaWRlci5sYXN0ICYmIHRhcmdldCA9PT0gMCAmJiB2YXJzLmFuaW1hdGlvbkxvb3AgJiYgc2xpZGVyLmRpcmVjdGlvbiAhPT0gInByZXYiKSB7DQogICAgICAgICAgICBzbGlkZVN0cmluZyA9IChyZXZlcnNlKSA/IDAgOiAoc2xpZGVyLmNvdW50ICsgMSkgKiBkaW1lbnNpb247DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlU3RyaW5nID0gKHJldmVyc2UpID8gKChzbGlkZXIuY291bnQgLSAxKSAtIHRhcmdldCArIHNsaWRlci5jbG9uZU9mZnNldCkgKiBkaW1lbnNpb24gOiAodGFyZ2V0ICsgc2xpZGVyLmNsb25lT2Zmc2V0KSAqIGRpbWVuc2lvbjsNCiAgICAgICAgICB9DQogICAgICAgICAgc2xpZGVyLnNldFByb3BzKHNsaWRlU3RyaW5nLCAiIiwgdmFycy5hbmltYXRpb25TcGVlZCk7DQogICAgICAgICAgaWYgKHNsaWRlci50cmFuc2l0aW9ucykgew0KICAgICAgICAgICAgaWYgKCF2YXJzLmFuaW1hdGlvbkxvb3AgfHwgIXNsaWRlci5hdEVuZCkgew0KICAgICAgICAgICAgICBzbGlkZXIuYW5pbWF0aW5nID0gZmFsc2U7DQogICAgICAgICAgICAgIHNsaWRlci5jdXJyZW50U2xpZGUgPSBzbGlkZXIuYW5pbWF0aW5nVG87DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzbGlkZXIuY29udGFpbmVyLnVuYmluZCgid2Via2l0VHJhbnNpdGlvbkVuZCB0cmFuc2l0aW9uZW5kIik7DQogICAgICAgICAgICBzbGlkZXIuY29udGFpbmVyLmJpbmQoIndlYmtpdFRyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCIsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICBzbGlkZXIud3JhcHVwKGRpbWVuc2lvbik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2xpZGVyLmNvbnRhaW5lci5hbmltYXRlKHNsaWRlci5hcmdzLCB2YXJzLmFuaW1hdGlvblNwZWVkLCB2YXJzLmVhc2luZywgZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgc2xpZGVyLndyYXB1cChkaW1lbnNpb24pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgeyAvLyBGQURFOg0KICAgICAgICAgIGlmICghdG91Y2gpIHsNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMuZXEoc2xpZGVyLmN1cnJlbnRTbGlkZSkuZmFkZU91dCh2YXJzLmFuaW1hdGlvblNwZWVkLCB2YXJzLmVhc2luZyk7DQogICAgICAgICAgICBzbGlkZXIuc2xpZGVzLmVxKHRhcmdldCkuZmFkZUluKHZhcnMuYW5pbWF0aW9uU3BlZWQsIHZhcnMuZWFzaW5nLCBzbGlkZXIud3JhcHVwKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2xpZGVyLnNsaWRlcy5lcShzbGlkZXIuY3VycmVudFNsaWRlKS5jc3MoeyAib3BhY2l0eSI6IDAsICJ6SW5kZXgiOiAxIH0pOw0KICAgICAgICAgICAgc2xpZGVyLnNsaWRlcy5lcSh0YXJnZXQpLmNzcyh7ICJvcGFjaXR5IjogMSwgInpJbmRleCI6IDIgfSk7DQogICAgICAgICAgICBzbGlkZXIuYW5pbWF0aW5nID0gZmFsc2U7DQogICAgICAgICAgICBzbGlkZXIuY3VycmVudFNsaWRlID0gc2xpZGVyLmFuaW1hdGluZ1RvOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBTTU9PVEggSEVJR0hUOg0KICAgICAgICBpZiAodmFycy5zbW9vdGhIZWlnaHQpIG1ldGhvZHMuc21vb3RoSGVpZ2h0KHZhcnMuYW5pbWF0aW9uU3BlZWQpOw0KICAgICAgfQ0KICAgIH0gDQogICAgc2xpZGVyLndyYXB1cCA9IGZ1bmN0aW9uKGRpbWVuc2lvbikgew0KICAgICAgLy8gU0xJREU6DQogICAgICBpZiAoIWZhZGUgJiYgIWNhcm91c2VsKSB7DQogICAgICAgIGlmIChzbGlkZXIuY3VycmVudFNsaWRlID09PSAwICYmIHNsaWRlci5hbmltYXRpbmdUbyA9PT0gc2xpZGVyLmxhc3QgJiYgdmFycy5hbmltYXRpb25Mb29wKSB7DQogICAgICAgICAgc2xpZGVyLnNldFByb3BzKGRpbWVuc2lvbiwgImp1bXBFbmQiKTsNCiAgICAgICAgfSBlbHNlIGlmIChzbGlkZXIuY3VycmVudFNsaWRlID09PSBzbGlkZXIubGFzdCAmJiBzbGlkZXIuYW5pbWF0aW5nVG8gPT09IDAgJiYgdmFycy5hbmltYXRpb25Mb29wKSB7DQogICAgICAgICAgc2xpZGVyLnNldFByb3BzKGRpbWVuc2lvbiwgImp1bXBTdGFydCIpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBzbGlkZXIuYW5pbWF0aW5nID0gZmFsc2U7DQogICAgICBzbGlkZXIuY3VycmVudFNsaWRlID0gc2xpZGVyLmFuaW1hdGluZ1RvOw0KICAgICAgLy8gQVBJOiBhZnRlcigpIGFuaW1hdGlvbiBDYWxsYmFjaw0KICAgICAgdmFycy5hZnRlcihzbGlkZXIpOw0KICAgIH0NCiAgICANCiAgICAvLyBTTElERVNIT1c6DQogICAgc2xpZGVyLmFuaW1hdGVTbGlkZXMgPSBmdW5jdGlvbigpIHsNCiAgICAgIGlmICghc2xpZGVyLmFuaW1hdGluZykgc2xpZGVyLmZsZXhBbmltYXRlKHNsaWRlci5nZXRUYXJnZXQoIm5leHQiKSk7DQogICAgfQ0KICAgIC8vIFNMSURFU0hPVzoNCiAgICBzbGlkZXIucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgIGNsZWFySW50ZXJ2YWwoc2xpZGVyLmFuaW1hdGVkU2xpZGVzKTsNCiAgICAgIHNsaWRlci5wbGF5aW5nID0gZmFsc2U7DQogICAgICAvLyBQQVVTRVBMQVk6DQogICAgICBpZiAodmFycy5wYXVzZVBsYXkpIG1ldGhvZHMucGF1c2VQbGF5LnVwZGF0ZSgicGxheSIpOw0KICAgICAgLy8gU1lOQzoNCiAgICAgIGlmIChzbGlkZXIuc3luY0V4aXN0cykgbWV0aG9kcy5zeW5jKCJwYXVzZSIpOw0KICAgIH0NCiAgICAvLyBTTElERVNIT1c6DQogICAgc2xpZGVyLnBsYXkgPSBmdW5jdGlvbigpIHsNCiAgICAgIHNsaWRlci5hbmltYXRlZFNsaWRlcyA9IHNldEludGVydmFsKHNsaWRlci5hbmltYXRlU2xpZGVzLCB2YXJzLnNsaWRlc2hvd1NwZWVkKTsNCiAgICAgIHNsaWRlci5wbGF5aW5nID0gdHJ1ZTsNCiAgICAgIC8vIFBBVVNFUExBWToNCiAgICAgIGlmICh2YXJzLnBhdXNlUGxheSkgbWV0aG9kcy5wYXVzZVBsYXkudXBkYXRlKCJwYXVzZSIpOw0KICAgICAgLy8gU1lOQzoNCiAgICAgIGlmIChzbGlkZXIuc3luY0V4aXN0cykgbWV0aG9kcy5zeW5jKCJwbGF5Iik7DQogICAgfQ0KICAgIHNsaWRlci5jYW5BZHZhbmNlID0gZnVuY3Rpb24odGFyZ2V0LCBmcm9tTmF2KSB7DQogICAgICAvLyBBU05BVjoNCiAgICAgIHZhciBsYXN0ID0gKGFzTmF2KSA/IHNsaWRlci5wYWdpbmdDb3VudCAtIDEgOiBzbGlkZXIubGFzdDsNCiAgICAgIHJldHVybiAoZnJvbU5hdikgPyB0cnVlIDoNCiAgICAgICAgICAgICAoYXNOYXYgJiYgc2xpZGVyLmN1cnJlbnRJdGVtID09PSBzbGlkZXIuY291bnQgLSAxICYmIHRhcmdldCA9PT0gMCAmJiBzbGlkZXIuZGlyZWN0aW9uID09PSAicHJldiIpID8gdHJ1ZSA6DQogICAgICAgICAgICAgKGFzTmF2ICYmIHNsaWRlci5jdXJyZW50SXRlbSA9PT0gMCAmJiB0YXJnZXQgPT09IHNsaWRlci5wYWdpbmdDb3VudCAtIDEgJiYgc2xpZGVyLmRpcmVjdGlvbiAhPT0gIm5leHQiKSA/IGZhbHNlIDoNCiAgICAgICAgICAgICAodGFyZ2V0ID09PSBzbGlkZXIuY3VycmVudFNsaWRlICYmICFhc05hdikgPyBmYWxzZSA6DQogICAgICAgICAgICAgKHZhcnMuYW5pbWF0aW9uTG9vcCkgPyB0cnVlIDoNCiAgICAgICAgICAgICAoc2xpZGVyLmF0RW5kICYmIHNsaWRlci5jdXJyZW50U2xpZGUgPT09IDAgJiYgdGFyZ2V0ID09PSBsYXN0ICYmIHNsaWRlci5kaXJlY3Rpb24gIT09ICJuZXh0IikgPyBmYWxzZSA6DQogICAgICAgICAgICAgKHNsaWRlci5hdEVuZCAmJiBzbGlkZXIuY3VycmVudFNsaWRlID09PSBsYXN0ICYmIHRhcmdldCA9PT0gMCAmJiBzbGlkZXIuZGlyZWN0aW9uID09PSAibmV4dCIpID8gZmFsc2UgOg0KICAgICAgICAgICAgIHRydWU7DQogICAgfQ0KICAgIHNsaWRlci5nZXRUYXJnZXQgPSBmdW5jdGlvbihkaXIpIHsNCiAgICAgIHNsaWRlci5kaXJlY3Rpb24gPSBkaXI7IA0KICAgICAgaWYgKGRpciA9PT0gIm5leHQiKSB7DQogICAgICAgIHJldHVybiAoc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gc2xpZGVyLmxhc3QpID8gMCA6IHNsaWRlci5jdXJyZW50U2xpZGUgKyAxOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIChzbGlkZXIuY3VycmVudFNsaWRlID09PSAwKSA/IHNsaWRlci5sYXN0IDogc2xpZGVyLmN1cnJlbnRTbGlkZSAtIDE7DQogICAgICB9DQogICAgfQ0KICAgIA0KICAgIC8vIFNMSURFOg0KICAgIHNsaWRlci5zZXRQcm9wcyA9IGZ1bmN0aW9uKHBvcywgc3BlY2lhbCwgZHVyKSB7DQogICAgICB2YXIgdGFyZ2V0ID0gKGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgcG9zQ2hlY2sgPSAocG9zKSA/IHBvcyA6ICgoc2xpZGVyLml0ZW1XICsgdmFycy5pdGVtTWFyZ2luKSAqIHNsaWRlci5tb3ZlKSAqIHNsaWRlci5hbmltYXRpbmdUbywNCiAgICAgICAgICAgIHBvc0NhbGMgPSAoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgIGlmIChjYXJvdXNlbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAoc3BlY2lhbCA9PT0gInNldFRvdWNoIikgPyBwb3MgOg0KICAgICAgICAgICAgICAgICAgICAgICAocmV2ZXJzZSAmJiBzbGlkZXIuYW5pbWF0aW5nVG8gPT09IHNsaWRlci5sYXN0KSA/IDAgOg0KICAgICAgICAgICAgICAgICAgICAgICAocmV2ZXJzZSkgPyBzbGlkZXIubGltaXQgLSAoKChzbGlkZXIuaXRlbVcgKyB2YXJzLml0ZW1NYXJnaW4pICogc2xpZGVyLm1vdmUpICogc2xpZGVyLmFuaW1hdGluZ1RvKSA6DQogICAgICAgICAgICAgICAgICAgICAgIChzbGlkZXIuYW5pbWF0aW5nVG8gPT09IHNsaWRlci5sYXN0KSA/IHNsaWRlci5saW1pdCA6IHBvc0NoZWNrOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoc3BlY2lhbCkgew0KICAgICAgICAgICAgICAgICAgY2FzZSAic2V0VG90YWwiOiByZXR1cm4gKHJldmVyc2UpID8gKChzbGlkZXIuY291bnQgLSAxKSAtIHNsaWRlci5jdXJyZW50U2xpZGUgKyBzbGlkZXIuY2xvbmVPZmZzZXQpICogcG9zIDogKHNsaWRlci5jdXJyZW50U2xpZGUgKyBzbGlkZXIuY2xvbmVPZmZzZXQpICogcG9zOw0KICAgICAgICAgICAgICAgICAgY2FzZSAic2V0VG91Y2giOiByZXR1cm4gKHJldmVyc2UpID8gcG9zIDogcG9zOw0KICAgICAgICAgICAgICAgICAgY2FzZSAianVtcEVuZCI6IHJldHVybiAocmV2ZXJzZSkgPyBwb3MgOiBzbGlkZXIuY291bnQgKiBwb3M7DQogICAgICAgICAgICAgICAgICBjYXNlICJqdW1wU3RhcnQiOiByZXR1cm4gKHJldmVyc2UpID8gc2xpZGVyLmNvdW50ICogcG9zIDogcG9zOw0KICAgICAgICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIHBvczsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0oKSk7DQogICAgICAgICAgICByZXR1cm4gKHBvc0NhbGMgKiAtMSkgKyAicHgiOw0KICAgICAgICAgIH0oKSk7DQoNCiAgICAgIGlmIChzbGlkZXIudHJhbnNpdGlvbnMpIHsNCiAgICAgICAgdGFyZ2V0ID0gKHZlcnRpY2FsKSA/ICJ0cmFuc2xhdGUzZCgwLCIgKyB0YXJnZXQgKyAiLDApIiA6ICJ0cmFuc2xhdGUzZCgiICsgdGFyZ2V0ICsgIiwwLDApIjsNCiAgICAgICAgZHVyID0gKGR1ciAhPT0gdW5kZWZpbmVkKSA/IChkdXIvMTAwMCkgKyAicyIgOiAiMHMiOw0KICAgICAgICBzbGlkZXIuY29udGFpbmVyLmNzcygiLSIgKyBzbGlkZXIucGZ4ICsgIi10cmFuc2l0aW9uLWR1cmF0aW9uIiwgZHVyKTsNCiAgICAgIH0NCiAgICAgIA0KICAgICAgc2xpZGVyLmFyZ3Nbc2xpZGVyLnByb3BdID0gdGFyZ2V0Ow0KICAgICAgaWYgKHNsaWRlci50cmFuc2l0aW9ucyB8fCBkdXIgPT09IHVuZGVmaW5lZCkgc2xpZGVyLmNvbnRhaW5lci5jc3Moc2xpZGVyLmFyZ3MpOw0KICAgIH0NCiAgICANCiAgICBzbGlkZXIuc2V0dXAgPSBmdW5jdGlvbih0eXBlKSB7DQogICAgICAvLyBTTElERToNCiAgICAgIGlmICghZmFkZSkgew0KICAgICAgICB2YXIgc2xpZGVyT2Zmc2V0LCBhcnI7DQogICAgICAgICAgICANCiAgICAgICAgaWYgKHR5cGUgPT09ICJpbml0Iikgew0KICAgICAgICAgIHNsaWRlci52aWV3cG9ydCA9ICQoJzxkaXYgY2xhc3M9IicgKyBuYW1lc3BhY2UgKyAndmlld3BvcnQiPjwvZGl2PicpLmNzcyh7Im92ZXJmbG93IjogImhpZGRlbiIsICJwb3NpdGlvbiI6ICJyZWxhdGl2ZSJ9KS5hcHBlbmRUbyhzbGlkZXIpLmFwcGVuZChzbGlkZXIuY29udGFpbmVyKTsNCiAgICAgICAgICAvLyBJTkZJTklURSBMT09QOg0KICAgICAgICAgIHNsaWRlci5jbG9uZUNvdW50ID0gMDsNCiAgICAgICAgICBzbGlkZXIuY2xvbmVPZmZzZXQgPSAwOw0KICAgICAgICAgIC8vIFJFVkVSU0U6DQogICAgICAgICAgaWYgKHJldmVyc2UpIHsNCiAgICAgICAgICAgIGFyciA9ICQubWFrZUFycmF5KHNsaWRlci5zbGlkZXMpLnJldmVyc2UoKTsNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMgPSAkKGFycik7DQogICAgICAgICAgICBzbGlkZXIuY29udGFpbmVyLmVtcHR5KCkuYXBwZW5kKHNsaWRlci5zbGlkZXMpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBJTkZJTklURSBMT09QICYmICFDQVJPVVNFTDoNCiAgICAgICAgaWYgKHZhcnMuYW5pbWF0aW9uTG9vcCAmJiAhY2Fyb3VzZWwpIHsNCiAgICAgICAgICBzbGlkZXIuY2xvbmVDb3VudCA9IDI7DQogICAgICAgICAgc2xpZGVyLmNsb25lT2Zmc2V0ID0gMTsNCiAgICAgICAgICAvLyBjbGVhciBvdXQgb2xkIGNsb25lcw0KICAgICAgICAgIGlmICh0eXBlICE9PSAiaW5pdCIpIHNsaWRlci5jb250YWluZXIuZmluZCgnLmNsb25lJykucmVtb3ZlKCk7DQogICAgICAgICAgc2xpZGVyLmNvbnRhaW5lci5hcHBlbmQoc2xpZGVyLnNsaWRlcy5maXJzdCgpLmNsb25lKCkuYWRkQ2xhc3MoJ2Nsb25lJykpLnByZXBlbmQoc2xpZGVyLnNsaWRlcy5sYXN0KCkuY2xvbmUoKS5hZGRDbGFzcygnY2xvbmUnKSk7DQogICAgICAgIH0NCiAgICAgICAgc2xpZGVyLm5ld1NsaWRlcyA9ICQodmFycy5zZWxlY3Rvciwgc2xpZGVyKTsNCiAgICAgICAgDQogICAgICAgIHNsaWRlck9mZnNldCA9IChyZXZlcnNlKSA/IHNsaWRlci5jb3VudCAtIDEgLSBzbGlkZXIuY3VycmVudFNsaWRlICsgc2xpZGVyLmNsb25lT2Zmc2V0IDogc2xpZGVyLmN1cnJlbnRTbGlkZSArIHNsaWRlci5jbG9uZU9mZnNldDsNCiAgICAgICAgLy8gVkVSVElDQUw6DQogICAgICAgIGlmICh2ZXJ0aWNhbCAmJiAhY2Fyb3VzZWwpIHsNCiAgICAgICAgICBzbGlkZXIuY29udGFpbmVyLmhlaWdodCgoc2xpZGVyLmNvdW50ICsgc2xpZGVyLmNsb25lQ291bnQpICogMjAwICsgIiUiKS5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIikud2lkdGgoIjEwMCUiKTsNCiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7DQogICAgICAgICAgICBzbGlkZXIubmV3U2xpZGVzLmNzcyh7ImRpc3BsYXkiOiAiYmxvY2sifSk7DQogICAgICAgICAgICBzbGlkZXIuZG9NYXRoKCk7DQogICAgICAgICAgICBzbGlkZXIudmlld3BvcnQuaGVpZ2h0KHNsaWRlci5oKTsNCiAgICAgICAgICAgIHNsaWRlci5zZXRQcm9wcyhzbGlkZXJPZmZzZXQgKiBzbGlkZXIuaCwgImluaXQiKTsNCiAgICAgICAgICB9LCAodHlwZSA9PT0gImluaXQiKSA/IDEwMCA6IDApOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHNsaWRlci5jb250YWluZXIud2lkdGgoKHNsaWRlci5jb3VudCArIHNsaWRlci5jbG9uZUNvdW50KSAqIDIwMCArICIlIik7DQogICAgICAgICAgc2xpZGVyLnNldFByb3BzKHNsaWRlck9mZnNldCAqIHNsaWRlci5jb21wdXRlZFcsICJpbml0Iik7DQogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgc2xpZGVyLmRvTWF0aCgpOw0KICAgICAgICAgICAgc2xpZGVyLm5ld1NsaWRlcy5jc3MoeyJ3aWR0aCI6IHNsaWRlci5jb21wdXRlZFcsICJmbG9hdCI6ICJsZWZ0IiwgImRpc3BsYXkiOiAiYmxvY2sifSk7DQogICAgICAgICAgICAvLyBTTU9PVEggSEVJR0hUOg0KICAgICAgICAgICAgaWYgKHZhcnMuc21vb3RoSGVpZ2h0KSBtZXRob2RzLnNtb290aEhlaWdodCgpOw0KICAgICAgICAgIH0sICh0eXBlID09PSAiaW5pdCIpID8gMTAwIDogMCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7IC8vIEZBREU6IA0KICAgICAgICBzbGlkZXIuc2xpZGVzLmNzcyh7IndpZHRoIjogIjEwMCUiLCAiZmxvYXQiOiAibGVmdCIsICJtYXJnaW5SaWdodCI6ICItMTAwJSIsICJwb3NpdGlvbiI6ICJyZWxhdGl2ZSJ9KTsNCiAgICAgICAgaWYgKHR5cGUgPT09ICJpbml0Iikgew0KICAgICAgICAgIGlmICghdG91Y2gpIHsNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMuZXEoc2xpZGVyLmN1cnJlbnRTbGlkZSkuZmFkZUluKHZhcnMuYW5pbWF0aW9uU3BlZWQsIHZhcnMuZWFzaW5nKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2xpZGVyLnNsaWRlcy5jc3MoeyAib3BhY2l0eSI6IDAsICJkaXNwbGF5IjogImJsb2NrIiwgIndlYmtpdFRyYW5zaXRpb24iOiAib3BhY2l0eSAiICsgdmFycy5hbmltYXRpb25TcGVlZCAvIDEwMDAgKyAicyBlYXNlIiwgInpJbmRleCI6IDEgfSkuZXEoc2xpZGVyLmN1cnJlbnRTbGlkZSkuY3NzKHsgIm9wYWNpdHkiOiAxLCAiekluZGV4IjogMn0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBTTU9PVEggSEVJR0hUOg0KICAgICAgICBpZiAodmFycy5zbW9vdGhIZWlnaHQpIG1ldGhvZHMuc21vb3RoSGVpZ2h0KCk7DQogICAgICB9DQogICAgICAvLyAhQ0FST1VTRUw6DQogICAgICAvLyBDQU5ESURBVEU6IGFjdGl2ZSBzbGlkZQ0KICAgICAgaWYgKCFjYXJvdXNlbCkgc2xpZGVyLnNsaWRlcy5yZW1vdmVDbGFzcyhuYW1lc3BhY2UgKyAiYWN0aXZlLXNsaWRlIikuZXEoc2xpZGVyLmN1cnJlbnRTbGlkZSkuYWRkQ2xhc3MobmFtZXNwYWNlICsgImFjdGl2ZS1zbGlkZSIpOw0KICAgIH0NCiAgICANCiAgICBzbGlkZXIuZG9NYXRoID0gZnVuY3Rpb24oKSB7DQogICAgICB2YXIgc2xpZGUgPSBzbGlkZXIuc2xpZGVzLmZpcnN0KCksDQogICAgICAgICAgc2xpZGVNYXJnaW4gPSB2YXJzLml0ZW1NYXJnaW4sDQogICAgICAgICAgbWluSXRlbXMgPSB2YXJzLm1pbkl0ZW1zLA0KICAgICAgICAgIG1heEl0ZW1zID0gdmFycy5tYXhJdGVtczsNCiAgICAgIA0KICAgICAgc2xpZGVyLncgPSBzbGlkZXIud2lkdGgoKTsNCiAgICAgIHNsaWRlci5oID0gc2xpZGUuaGVpZ2h0KCk7DQogICAgICBzbGlkZXIuYm94UGFkZGluZyA9IHNsaWRlLm91dGVyV2lkdGgoKSAtIHNsaWRlLndpZHRoKCk7DQoNCiAgICAgIC8vIENBUk9VU0VMOg0KICAgICAgaWYgKGNhcm91c2VsKSB7DQogICAgICAgIHNsaWRlci5pdGVtVCA9IHZhcnMuaXRlbVdpZHRoICsgc2xpZGVNYXJnaW47DQogICAgICAgIHNsaWRlci5taW5XID0gKG1pbkl0ZW1zKSA/IG1pbkl0ZW1zICogc2xpZGVyLml0ZW1UIDogc2xpZGVyLnc7DQogICAgICAgIHNsaWRlci5tYXhXID0gKG1heEl0ZW1zKSA/IG1heEl0ZW1zICogc2xpZGVyLml0ZW1UIDogc2xpZGVyLnc7DQogICAgICAgIHNsaWRlci5pdGVtVyA9IChzbGlkZXIubWluVyA+IHNsaWRlci53KSA/IChzbGlkZXIudyAtIChzbGlkZU1hcmdpbiAqIG1pbkl0ZW1zKSkvbWluSXRlbXMgOg0KICAgICAgICAgICAgICAgICAgICAgICAoc2xpZGVyLm1heFcgPCBzbGlkZXIudykgPyAoc2xpZGVyLncgLSAoc2xpZGVNYXJnaW4gKiBtYXhJdGVtcykpL21heEl0ZW1zIDoNCiAgICAgICAgICAgICAgICAgICAgICAgKHZhcnMuaXRlbVdpZHRoID4gc2xpZGVyLncpID8gc2xpZGVyLncgOiB2YXJzLml0ZW1XaWR0aDsNCiAgICAgICAgc2xpZGVyLnZpc2libGUgPSBNYXRoLmZsb29yKHNsaWRlci53LyhzbGlkZXIuaXRlbVcgKyBzbGlkZU1hcmdpbikpOw0KICAgICAgICBzbGlkZXIubW92ZSA9ICh2YXJzLm1vdmUgPiAwICYmIHZhcnMubW92ZSA8IHNsaWRlci52aXNpYmxlICkgPyB2YXJzLm1vdmUgOiBzbGlkZXIudmlzaWJsZTsNCiAgICAgICAgc2xpZGVyLnBhZ2luZ0NvdW50ID0gTWF0aC5jZWlsKCgoc2xpZGVyLmNvdW50IC0gc2xpZGVyLnZpc2libGUpL3NsaWRlci5tb3ZlKSArIDEpOw0KICAgICAgICBzbGlkZXIubGFzdCA9ICBzbGlkZXIucGFnaW5nQ291bnQgLSAxOw0KICAgICAgICBzbGlkZXIubGltaXQgPSAoc2xpZGVyLnBhZ2luZ0NvdW50ID09PSAxKSA/IDAgOg0KICAgICAgICAgICAgICAgICAgICAgICAodmFycy5pdGVtV2lkdGggPiBzbGlkZXIudykgPyAoKHNsaWRlci5pdGVtVyArIChzbGlkZU1hcmdpbiAqIDIpKSAqIHNsaWRlci5jb3VudCkgLSBzbGlkZXIudyAtIHNsaWRlTWFyZ2luIDogKChzbGlkZXIuaXRlbVcgKyBzbGlkZU1hcmdpbikgKiBzbGlkZXIuY291bnQpIC0gc2xpZGVyLncgLSBzbGlkZU1hcmdpbjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNsaWRlci5pdGVtVyA9IHNsaWRlci53Ow0KICAgICAgICBzbGlkZXIucGFnaW5nQ291bnQgPSBzbGlkZXIuY291bnQ7DQogICAgICAgIHNsaWRlci5sYXN0ID0gc2xpZGVyLmNvdW50IC0gMTsNCiAgICAgIH0NCiAgICAgIHNsaWRlci5jb21wdXRlZFcgPSBzbGlkZXIuaXRlbVcgLSBzbGlkZXIuYm94UGFkZGluZzsNCiAgICB9DQogICAgDQogICAgc2xpZGVyLnVwZGF0ZSA9IGZ1bmN0aW9uKHBvcywgYWN0aW9uKSB7DQogICAgICBzbGlkZXIuZG9NYXRoKCk7DQogICAgICANCiAgICAgIC8vIHVwZGF0ZSBjdXJyZW50U2xpZGUgYW5kIHNsaWRlci5hbmltYXRpbmdUbyBpZiBuZWNlc3NhcnkNCiAgICAgIGlmICghY2Fyb3VzZWwpIHsNCiAgICAgICAgaWYgKHBvcyA8IHNsaWRlci5jdXJyZW50U2xpZGUpIHsNCiAgICAgICAgICBzbGlkZXIuY3VycmVudFNsaWRlICs9IDE7DQogICAgICAgIH0gZWxzZSBpZiAocG9zIDw9IHNsaWRlci5jdXJyZW50U2xpZGUgJiYgcG9zICE9PSAwKSB7DQogICAgICAgICAgc2xpZGVyLmN1cnJlbnRTbGlkZSAtPSAxOw0KICAgICAgICB9DQogICAgICAgIHNsaWRlci5hbmltYXRpbmdUbyA9IHNsaWRlci5jdXJyZW50U2xpZGU7DQogICAgICB9DQogICAgICANCiAgICAgIC8vIHVwZGF0ZSBjb250cm9sTmF2DQogICAgICBpZiAodmFycy5jb250cm9sTmF2ICYmICFzbGlkZXIubWFudWFsQ29udHJvbHMpIHsNCiAgICAgICAgaWYgKChhY3Rpb24gPT09ICJhZGQiICYmICFjYXJvdXNlbCkgfHwgc2xpZGVyLnBhZ2luZ0NvdW50ID4gc2xpZGVyLmNvbnRyb2xOYXYubGVuZ3RoKSB7DQogICAgICAgICAgbWV0aG9kcy5jb250cm9sTmF2LnVwZGF0ZSgiYWRkIik7DQogICAgICAgIH0gZWxzZSBpZiAoKGFjdGlvbiA9PT0gInJlbW92ZSIgJiYgIWNhcm91c2VsKSB8fCBzbGlkZXIucGFnaW5nQ291bnQgPCBzbGlkZXIuY29udHJvbE5hdi5sZW5ndGgpIHsNCiAgICAgICAgICBpZiAoY2Fyb3VzZWwgJiYgc2xpZGVyLmN1cnJlbnRTbGlkZSA+IHNsaWRlci5sYXN0KSB7DQogICAgICAgICAgICBzbGlkZXIuY3VycmVudFNsaWRlIC09IDE7DQogICAgICAgICAgICBzbGlkZXIuYW5pbWF0aW5nVG8gLT0gMTsNCiAgICAgICAgICB9DQogICAgICAgICAgbWV0aG9kcy5jb250cm9sTmF2LnVwZGF0ZSgicmVtb3ZlIiwgc2xpZGVyLmxhc3QpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvLyB1cGRhdGUgZGlyZWN0aW9uTmF2DQogICAgICBpZiAodmFycy5kaXJlY3Rpb25OYXYpIG1ldGhvZHMuZGlyZWN0aW9uTmF2LnVwZGF0ZSgpOw0KICAgICAgDQogICAgfQ0KICAgIA0KICAgIHNsaWRlci5hZGRTbGlkZSA9IGZ1bmN0aW9uKG9iaiwgcG9zKSB7DQogICAgICB2YXIgJG9iaiA9ICQob2JqKTsNCiAgICAgIA0KICAgICAgc2xpZGVyLmNvdW50ICs9IDE7DQogICAgICBzbGlkZXIubGFzdCA9IHNsaWRlci5jb3VudCAtIDE7DQogICAgICANCiAgICAgIC8vIGFwcGVuZCBuZXcgc2xpZGUNCiAgICAgIGlmICh2ZXJ0aWNhbCAmJiByZXZlcnNlKSB7DQogICAgICAgIChwb3MgIT09IHVuZGVmaW5lZCkgPyBzbGlkZXIuc2xpZGVzLmVxKHNsaWRlci5jb3VudCAtIHBvcykuYWZ0ZXIoJG9iaikgOiBzbGlkZXIuY29udGFpbmVyLnByZXBlbmQoJG9iaik7DQogICAgICB9IGVsc2Ugew0KICAgICAgICAocG9zICE9PSB1bmRlZmluZWQpID8gc2xpZGVyLnNsaWRlcy5lcShwb3MpLmJlZm9yZSgkb2JqKSA6IHNsaWRlci5jb250YWluZXIuYXBwZW5kKCRvYmopOw0KICAgICAgfQ0KICAgICAgDQogICAgICAvLyB1cGRhdGUgY3VycmVudFNsaWRlLCBhbmltYXRpbmdUbywgY29udHJvbE5hdiwgYW5kIGRpcmVjdGlvbk5hdg0KICAgICAgc2xpZGVyLnVwZGF0ZShwb3MsICJhZGQiKTsNCiAgICAgIA0KICAgICAgLy8gdXBkYXRlIHNsaWRlci5zbGlkZXMNCiAgICAgIHNsaWRlci5zbGlkZXMgPSAkKHZhcnMuc2VsZWN0b3IgKyAnOm5vdCguY2xvbmUpJywgc2xpZGVyKTsNCiAgICAgIC8vIHJlLXNldHVwIHRoZSBzbGlkZXIgdG8gYWNjb21kYXRlIG5ldyBzbGlkZQ0KICAgICAgc2xpZGVyLnNldHVwKCk7DQogICAgICANCiAgICAgIC8vRmxleFNsaWRlcjogYWRkZWQoKSBDYWxsYmFjaw0KICAgICAgdmFycy5hZGRlZChzbGlkZXIpOw0KICAgIH0NCiAgICBzbGlkZXIucmVtb3ZlU2xpZGUgPSBmdW5jdGlvbihvYmopIHsNCiAgICAgIHZhciBwb3MgPSAoaXNOYU4ob2JqKSkgPyBzbGlkZXIuc2xpZGVzLmluZGV4KCQob2JqKSkgOiBvYmo7DQogICAgICANCiAgICAgIC8vIHVwZGF0ZSBjb3VudA0KICAgICAgc2xpZGVyLmNvdW50IC09IDE7DQogICAgICBzbGlkZXIubGFzdCA9IHNsaWRlci5jb3VudCAtIDE7DQogICAgICANCiAgICAgIC8vIHJlbW92ZSBzbGlkZQ0KICAgICAgaWYgKGlzTmFOKG9iaikpIHsNCiAgICAgICAgJChvYmosIHNsaWRlci5zbGlkZXMpLnJlbW92ZSgpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgKHZlcnRpY2FsICYmIHJldmVyc2UpID8gc2xpZGVyLnNsaWRlcy5lcShzbGlkZXIubGFzdCkucmVtb3ZlKCkgOiBzbGlkZXIuc2xpZGVzLmVxKG9iaikucmVtb3ZlKCk7DQogICAgICB9DQogICAgICANCiAgICAgIC8vIHVwZGF0ZSBjdXJyZW50U2xpZGUsIGFuaW1hdGluZ1RvLCBjb250cm9sTmF2LCBhbmQgZGlyZWN0aW9uTmF2DQogICAgICBzbGlkZXIuZG9NYXRoKCk7DQogICAgICBzbGlkZXIudXBkYXRlKHBvcywgInJlbW92ZSIpOw0KICAgICAgDQogICAgICAvLyB1cGRhdGUgc2xpZGVyLnNsaWRlcw0KICAgICAgc2xpZGVyLnNsaWRlcyA9ICQodmFycy5zZWxlY3RvciArICc6bm90KC5jbG9uZSknLCBzbGlkZXIpOw0KICAgICAgLy8gcmUtc2V0dXAgdGhlIHNsaWRlciB0byBhY2NvbWRhdGUgbmV3IHNsaWRlDQogICAgICBzbGlkZXIuc2V0dXAoKTsNCiAgICAgIA0KICAgICAgLy8gRmxleFNsaWRlcjogcmVtb3ZlZCgpIENhbGxiYWNrDQogICAgICB2YXJzLnJlbW92ZWQoc2xpZGVyKTsNCiAgICB9DQogICAgDQogICAgLy9GbGV4U2xpZGVyOiBJbml0aWFsaXplDQogICAgbWV0aG9kcy5pbml0KCk7DQogIH0NCiAgDQogIC8vRmxleFNsaWRlcjogRGVmYXVsdCBTZXR0aW5ncw0KICAkLmZsZXhzbGlkZXIuZGVmYXVsdHMgPSB7DQogICAgbmFtZXNwYWNlOiAiZmxleC0iLCAgICAgICAgICAgICAvL3tORVd9IFN0cmluZzogUHJlZml4IHN0cmluZyBhdHRhY2hlZCB0byB0aGUgY2xhc3Mgb2YgZXZlcnkgZWxlbWVudCBnZW5lcmF0ZWQgYnkgdGhlIHBsdWdpbg0KICAgIHNlbGVjdG9yOiAiLnNsaWRlcyA+IGxpIiwgICAgICAgLy97TkVXfSBTZWxlY3RvcjogTXVzdCBtYXRjaCBhIHNpbXBsZSBwYXR0ZXJuLiAne2NvbnRhaW5lcn0gPiB7c2xpZGV9JyAtLSBJZ25vcmUgcGF0dGVybiBhdCB5b3VyIG93biBwZXJpbA0KICAgIGFuaW1hdGlvbjogImZhZGUiLCAgICAgICAgICAgICAgLy9TdHJpbmc6IFNlbGVjdCB5b3VyIGFuaW1hdGlvbiB0eXBlLCAiZmFkZSIgb3IgInNsaWRlIg0KICAgIGVhc2luZzogInN3aW5nIiwgICAgICAgICAgICAgICAvL3tORVd9IFN0cmluZzogRGV0ZXJtaW5lcyB0aGUgZWFzaW5nIG1ldGhvZCB1c2VkIGluIGpRdWVyeSB0cmFuc2l0aW9ucy4galF1ZXJ5IGVhc2luZyBwbHVnaW4gaXMgc3VwcG9ydGVkIQ0KICAgIGRpcmVjdGlvbjogImhvcml6b250YWwiLCAgICAgICAgLy9TdHJpbmc6IFNlbGVjdCB0aGUgc2xpZGluZyBkaXJlY3Rpb24sICJob3Jpem9udGFsIiBvciAidmVydGljYWwiDQogICAgcmV2ZXJzZTogZmFsc2UsICAgICAgICAgICAgICAgICAvL3tORVd9IEJvb2xlYW46IFJldmVyc2UgdGhlIGFuaW1hdGlvbiBkaXJlY3Rpb24NCiAgICBhbmltYXRpb25Mb29wOiB0cnVlLCAgICAgICAgICAgICAvL0Jvb2xlYW46IFNob3VsZCB0aGUgYW5pbWF0aW9uIGxvb3A/IElmIGZhbHNlLCBkaXJlY3Rpb25OYXYgd2lsbCByZWNlaXZlZCAiZGlzYWJsZSIgY2xhc3NlcyBhdCBlaXRoZXIgZW5kDQogICAgc21vb3RoSGVpZ2h0OiBmYWxzZSwgICAgICAgICAgICAvL3tORVd9IEJvb2xlYW46IEFsbG93IGhlaWdodCBvZiB0aGUgc2xpZGVyIHRvIGFuaW1hdGUgc21vb3RobHkgaW4gaG9yaXpvbnRhbCBtb2RlICANCiAgICBzdGFydEF0OiAwLCAgICAgICAgICAgICAgICAgICAgIC8vSW50ZWdlcjogVGhlIHNsaWRlIHRoYXQgdGhlIHNsaWRlciBzaG91bGQgc3RhcnQgb24uIEFycmF5IG5vdGF0aW9uICgwID0gZmlyc3Qgc2xpZGUpDQogICAgc2xpZGVzaG93OiB0cnVlLCAgICAgICAgICAgICAgICAvL0Jvb2xlYW46IEFuaW1hdGUgc2xpZGVyIGF1dG9tYXRpY2FsbHkNCiAgICBzbGlkZXNob3dTcGVlZDogNzAwMCwgICAgICAgICAgIC8vSW50ZWdlcjogU2V0IHRoZSBzcGVlZCBvZiB0aGUgc2xpZGVzaG93IGN5Y2xpbmcsIGluIG1pbGxpc2Vjb25kcw0KICAgIGFuaW1hdGlvblNwZWVkOiA2MDAsICAgICAgICAgICAgLy9JbnRlZ2VyOiBTZXQgdGhlIHNwZWVkIG9mIGFuaW1hdGlvbnMsIGluIG1pbGxpc2Vjb25kcw0KICAgIGluaXREZWxheTogMCwgICAgICAgICAgICAgICAgICAgLy97TkVXfSBJbnRlZ2VyOiBTZXQgYW4gaW5pdGlhbGl6YXRpb24gZGVsYXksIGluIG1pbGxpc2Vjb25kcw0KICAgIHJhbmRvbWl6ZTogZmFsc2UsICAgICAgICAgICAgICAgLy9Cb29sZWFuOiBSYW5kb21pemUgc2xpZGUgb3JkZXINCiAgICANCiAgICAvLyBVc2FiaWxpdHkgZmVhdHVyZXMNCiAgICBwYXVzZU9uQWN0aW9uOiB0cnVlLCAgICAgICAgICAgIC8vQm9vbGVhbjogUGF1c2UgdGhlIHNsaWRlc2hvdyB3aGVuIGludGVyYWN0aW5nIHdpdGggY29udHJvbCBlbGVtZW50cywgaGlnaGx5IHJlY29tbWVuZGVkLg0KICAgIHBhdXNlT25Ib3ZlcjogZmFsc2UsICAgICAgICAgICAgLy9Cb29sZWFuOiBQYXVzZSB0aGUgc2xpZGVzaG93IHdoZW4gaG92ZXJpbmcgb3ZlciBzbGlkZXIsIHRoZW4gcmVzdW1lIHdoZW4gbm8gbG9uZ2VyIGhvdmVyaW5nDQogICAgdXNlQ1NTOiB0cnVlLCAgICAgICAgICAgICAgICAgICAvL3tORVd9IEJvb2xlYW46IFNsaWRlciB3aWxsIHVzZSBDU1MzIHRyYW5zaXRpb25zIGlmIGF2YWlsYWJsZQ0KICAgIHRvdWNoOiB0cnVlLCAgICAgICAgICAgICAgICAgICAgLy97TkVXfSBCb29sZWFuOiBBbGxvdyB0b3VjaCBzd2lwZSBuYXZpZ2F0aW9uIG9mIHRoZSBzbGlkZXIgb24gdG91Y2gtZW5hYmxlZCBkZXZpY2VzDQogICAgdmlkZW86IGZhbHNlLCAgICAgICAgICAgICAgICAgICAvL3tORVd9IEJvb2xlYW46IElmIHVzaW5nIHZpZGVvIGluIHRoZSBzbGlkZXIsIHdpbGwgcHJldmVudCBDU1MzIDNEIFRyYW5zZm9ybXMgdG8gYXZvaWQgZ3JhcGhpY2FsIGdsaXRjaGVzDQogICAgDQogICAgLy8gUHJpbWFyeSBDb250cm9scw0KICAgIGNvbnRyb2xOYXY6IHRydWUsICAgICAgICAgICAgICAgLy9Cb29sZWFuOiBDcmVhdGUgbmF2aWdhdGlvbiBmb3IgcGFnaW5nIGNvbnRyb2wgb2YgZWFjaCBjbGlkZT8gTm90ZTogTGVhdmUgdHJ1ZSBmb3IgbWFudWFsQ29udHJvbHMgdXNhZ2UNCiAgICBkaXJlY3Rpb25OYXY6IHRydWUsICAgICAgICAgICAgIC8vQm9vbGVhbjogQ3JlYXRlIG5hdmlnYXRpb24gZm9yIHByZXZpb3VzL25leHQgbmF2aWdhdGlvbj8gKHRydWUvZmFsc2UpDQogICAgcHJldlRleHQ6ICJQcmV2aW91cyIsICAgICAgICAgICAvL1N0cmluZzogU2V0IHRoZSB0ZXh0IGZvciB0aGUgInByZXZpb3VzIiBkaXJlY3Rpb25OYXYgaXRlbQ0KICAgIG5leHRUZXh0OiAiTmV4dCIsICAgICAgICAgICAgICAgLy9TdHJpbmc6IFNldCB0aGUgdGV4dCBmb3IgdGhlICJuZXh0IiBkaXJlY3Rpb25OYXYgaXRlbQ0KICAgIA0KICAgIC8vIFNlY29uZGFyeSBOYXZpZ2F0aW9uDQogICAga2V5Ym9hcmQ6IHRydWUsICAgICAgICAgICAgICAgICAvL0Jvb2xlYW46IEFsbG93IHNsaWRlciBuYXZpZ2F0aW5nIHZpYSBrZXlib2FyZCBsZWZ0L3JpZ2h0IGtleXMNCiAgICBtdWx0aXBsZUtleWJvYXJkOiBmYWxzZSwgICAgICAgIC8ve05FV30gQm9vbGVhbjogQWxsb3cga2V5Ym9hcmQgbmF2aWdhdGlvbiB0byBhZmZlY3QgbXVsdGlwbGUgc2xpZGVycy4gRGVmYXVsdCBiZWhhdmlvciBjdXRzIG91dCBrZXlib2FyZCBuYXZpZ2F0aW9uIHdpdGggbW9yZSB0aGFuIG9uZSBzbGlkZXIgcHJlc2VudC4NCiAgICBtb3VzZXdoZWVsOiBmYWxzZSwgICAgICAgICAgICAgIC8ve1VQREFURUR9IEJvb2xlYW46IFJlcXVpcmVzIGpxdWVyeS5tb3VzZXdoZWVsLmpzIChodHRwczovL2dpdGh1Yi5jb20vYnJhbmRvbmFhcm9uL2pxdWVyeS1tb3VzZXdoZWVsKSAtIEFsbG93cyBzbGlkZXIgbmF2aWdhdGluZyB2aWEgbW91c2V3aGVlbA0KICAgIHBhdXNlUGxheTogZmFsc2UsICAgICAgICAgICAgICAgLy9Cb29sZWFuOiBDcmVhdGUgcGF1c2UvcGxheSBkeW5hbWljIGVsZW1lbnQNCiAgICBwYXVzZVRleHQ6ICJQYXVzZSIsICAgICAgICAgICAgIC8vU3RyaW5nOiBTZXQgdGhlIHRleHQgZm9yIHRoZSAicGF1c2UiIHBhdXNlUGxheSBpdGVtDQogICAgcGxheVRleHQ6ICJQbGF5IiwgICAgICAgICAgICAgICAvL1N0cmluZzogU2V0IHRoZSB0ZXh0IGZvciB0aGUgInBsYXkiIHBhdXNlUGxheSBpdGVtDQogICAgDQogICAgLy8gU3BlY2lhbCBwcm9wZXJ0aWVzDQogICAgY29udHJvbHNDb250YWluZXI6ICIiLCAgICAgICAgICAvL3tVUERBVEVEfSBqUXVlcnkgT2JqZWN0L1NlbGVjdG9yOiBEZWNsYXJlIHdoaWNoIGNvbnRhaW5lciB0aGUgbmF2aWdhdGlvbiBlbGVtZW50cyBzaG91bGQgYmUgYXBwZW5kZWQgdG9vLiBEZWZhdWx0IGNvbnRhaW5lciBpcyB0aGUgRmxleFNsaWRlciBlbGVtZW50LiBFeGFtcGxlIHVzZSB3b3VsZCBiZSAkKCIuZmxleHNsaWRlci1jb250YWluZXIiKS4gUHJvcGVydHkgaXMgaWdub3JlZCBpZiBnaXZlbiBlbGVtZW50IGlzIG5vdCBmb3VuZC4NCiAgICBtYW51YWxDb250cm9sczogIiIsICAgICAgICAgICAgIC8ve1VQREFURUR9IGpRdWVyeSBPYmplY3QvU2VsZWN0b3I6IERlY2xhcmUgY3VzdG9tIGNvbnRyb2wgbmF2aWdhdGlvbi4gRXhhbXBsZXMgd291bGQgYmUgJCgiLmZsZXgtY29udHJvbC1uYXYgbGkiKSBvciAiI3RhYnMtbmF2IGxpIGltZyIsIGV0Yy4gVGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiB5b3VyIGNvbnRyb2xOYXYgc2hvdWxkIG1hdGNoIHRoZSBudW1iZXIgb2Ygc2xpZGVzL3RhYnMuDQogICAgc3luYzogIiIsICAgICAgICAgICAgICAgICAgICAgICAvL3tORVd9IFNlbGVjdG9yOiBNaXJyb3IgdGhlIGFjdGlvbnMgcGVyZm9ybWVkIG9uIHRoaXMgc2xpZGVyIHdpdGggYW5vdGhlciBzbGlkZXIuIFVzZSB3aXRoIGNhcmUuDQogICAgYXNOYXZGb3I6ICIiLCAgICAgICAgICAgICAgICAgICAvL3tORVd9IFNlbGVjdG9yOiBJbnRlcm5hbCBwcm9wZXJ0eSBleHBvc2VkIGZvciB0dXJuaW5nIHRoZSBzbGlkZXIgaW50byBhIHRodW1ibmFpbCBuYXZpZ2F0aW9uIGZvciBhbm90aGVyIHNsaWRlcg0KICAgIA0KICAgIC8vIENhcm91c2VsIE9wdGlvbnMNCiAgICBpdGVtV2lkdGg6IDAsICAgICAgICAgICAgICAgICAgIC8ve05FV30gSW50ZWdlcjogQm94LW1vZGVsIHdpZHRoIG9mIGluZGl2aWR1YWwgY2Fyb3VzZWwgaXRlbXMsIGluY2x1ZGluZyBob3Jpem9udGFsIGJvcmRlcnMgYW5kIHBhZGRpbmcuDQogICAgaXRlbU1hcmdpbjogMCwgICAgICAgICAgICAgICAgICAvL3tORVd9IEludGVnZXI6IE1hcmdpbiBiZXR3ZWVuIGNhcm91c2VsIGl0ZW1zLg0KICAgIG1pbkl0ZW1zOiA1LCAgICAgICAgICAgICAgICAgICAgLy97TkVXfSBJbnRlZ2VyOiBNaW5pbXVtIG51bWJlciBvZiBjYXJvdXNlbCBpdGVtcyB0aGF0IHNob3VsZCBiZSB2aXNpYmxlLiBJdGVtcyB3aWxsIHJlc2l6ZSBmbHVpZGx5IHdoZW4gYmVsb3cgdGhpcy4NCiAgICBtYXhJdGVtczogNSwgICAgICAgICAgICAgICAgICAgIC8ve05FV30gSW50ZWdlcjogTWF4bWltdW0gbnVtYmVyIG9mIGNhcm91c2VsIGl0ZW1zIHRoYXQgc2hvdWxkIGJlIHZpc2libGUuIEl0ZW1zIHdpbGwgcmVzaXplIGZsdWlkbHkgd2hlbiBhYm92ZSB0aGlzIGxpbWl0Lg0KICAgIG1vdmU6IDAsICAgICAgICAgICAgICAgICAgICAgICAgLy97TkVXfSBJbnRlZ2VyOiBOdW1iZXIgb2YgY2Fyb3VzZWwgaXRlbXMgdGhhdCBzaG91bGQgbW92ZSBvbiBhbmltYXRpb24uIElmIDAsIHNsaWRlciB3aWxsIG1vdmUgYWxsIHZpc2libGUgaXRlbXMuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAvLyBDYWxsYmFjayBBUEkNCiAgICBzdGFydDogZnVuY3Rpb24oKXt9LCAgICAgICAgICAgIC8vQ2FsbGJhY2s6IGZ1bmN0aW9uKHNsaWRlcikgLSBGaXJlcyB3aGVuIHRoZSBzbGlkZXIgbG9hZHMgdGhlIGZpcnN0IHNsaWRlDQogICAgYmVmb3JlOiBmdW5jdGlvbigpe30sICAgICAgICAgICAvL0NhbGxiYWNrOiBmdW5jdGlvbihzbGlkZXIpIC0gRmlyZXMgYXN5bmNocm9ub3VzbHkgd2l0aCBlYWNoIHNsaWRlciBhbmltYXRpb24NCiAgICBhZnRlcjogZnVuY3Rpb24oKXt9LCAgICAgICAgICAgIC8vQ2FsbGJhY2s6IGZ1bmN0aW9uKHNsaWRlcikgLSBGaXJlcyBhZnRlciBlYWNoIHNsaWRlciBhbmltYXRpb24gY29tcGxldGVzDQogICAgZW5kOiBmdW5jdGlvbigpe30sICAgICAgICAgICAgICAvL0NhbGxiYWNrOiBmdW5jdGlvbihzbGlkZXIpIC0gRmlyZXMgd2hlbiB0aGUgc2xpZGVyIHJlYWNoZXMgdGhlIGxhc3Qgc2xpZGUgKGFzeW5jaHJvbm91cykNCiAgICBhZGRlZDogZnVuY3Rpb24oKXt9LCAgICAgICAgICAgIC8ve05FV30gQ2FsbGJhY2s6IGZ1bmN0aW9uKHNsaWRlcikgLSBGaXJlcyBhZnRlciBhIHNsaWRlIGlzIGFkZGVkDQogICAgcmVtb3ZlZDogZnVuY3Rpb24oKXt9ICAgICAgICAgICAvL3tORVd9IENhbGxiYWNrOiBmdW5jdGlvbihzbGlkZXIpIC0gRmlyZXMgYWZ0ZXIgYSBzbGlkZSBpcyByZW1vdmVkDQogIH0NCg0KDQogIC8vRmxleFNsaWRlcjogUGx1Z2luIEZ1bmN0aW9uDQogICQuZm4uZmxleHNsaWRlciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICBpZiAob3B0aW9ucyA9PT0gdW5kZWZpbmVkKSBvcHRpb25zID0ge307DQogICAgDQogICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAib2JqZWN0Iikgew0KICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSwNCiAgICAgICAgICAgIHNlbGVjdG9yID0gKG9wdGlvbnMuc2VsZWN0b3IpID8gb3B0aW9ucy5zZWxlY3RvciA6ICIuc2xpZGVzID4gbGkiLA0KICAgICAgICAgICAgJHNsaWRlcyA9ICR0aGlzLmZpbmQoc2VsZWN0b3IpOw0KDQogICAgICAgIGlmICgkc2xpZGVzLmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICRzbGlkZXMuZmFkZUluKDQwMCk7DQogICAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQpIG9wdGlvbnMuc3RhcnQoJHRoaXMpOw0KICAgICAgICB9IGVsc2UgaWYgKCR0aGlzLmRhdGEoJ2ZsZXhzbGlkZXInKSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgbmV3ICQuZmxleHNsaWRlcih0aGlzLCBvcHRpb25zKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSBlbHNlIHsNCiAgICAgIC8vIEhlbHBlciBzdHJpbmdzIHRvIHF1aWNrbHkgcGVyZm9ybSBmdW5jdGlvbnMgb24gdGhlIHNsaWRlcg0KICAgICAgdmFyICRzbGlkZXIgPSAkKHRoaXMpLmRhdGEoJ2ZsZXhzbGlkZXInKTsNCiAgICAgIHN3aXRjaCAob3B0aW9ucykgew0KICAgICAgICBjYXNlICJwbGF5IjogJHNsaWRlci5wbGF5KCk7IGJyZWFrOw0KICAgICAgICBjYXNlICJwYXVzZSI6ICRzbGlkZXIucGF1c2UoKTsgYnJlYWs7DQogICAgICAgIGNhc2UgIm5leHQiOiAkc2xpZGVyLmZsZXhBbmltYXRlKCRzbGlkZXIuZ2V0VGFyZ2V0KCJuZXh0IiksIHRydWUpOyBicmVhazsNCiAgICAgICAgY2FzZSAicHJldiI6DQogICAgICAgIGNhc2UgInByZXZpb3VzIjogJHNsaWRlci5mbGV4QW5pbWF0ZSgkc2xpZGVyLmdldFRhcmdldCgicHJldiIpLCB0cnVlKTsgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6IGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gIm51bWJlciIpICRzbGlkZXIuZmxleEFuaW1hdGUob3B0aW9ucywgdHJ1ZSk7DQogICAgICB9DQogICAgfQ0KICB9ICANCg0KfSkoalF1ZXJ5KTs=" jcr:lastModified="2015-05-15T16:51:18.509+07:00" jcr:mimeType="application/x-javascript"/></jquery.flexslider.js>